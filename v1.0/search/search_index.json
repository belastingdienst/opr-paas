{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"about/code-of-conduct/","title":"Code of Conduct","text":"<p>The Paas Operator project follows the CNCF Code of Conduct.</p>"},{"location":"about/contributing/","title":"Contributing to PaaS","text":"<p>Welcome! We are glad that you want to contribute to our PaaS Operator project! \ud83d\udc96</p> <p>As you get started, you are in the best position to give us feedbacks on areas of our project that we need help with, including:</p> <ul> <li>Problems found while setting up the development environment;</li> <li>Gaps in our documentation;</li> <li>Bugs in our Github actions;</li> <li>Promotion of PostgreSQL on Kubernetes with our operator;</li> </ul> <p>First, though, it is important that you read the Code of Conduct.</p> <p>The guidelines below are a starting point. We don't want to limit your creativity, passion, and initiative. If you think there's a better way, please feel free to bring it up in a Github discussion, or open a pull request. We're certain there are always better ways to do things, we just need to start some constructive dialogue!</p>"},{"location":"about/contributing/#ways-to-contribute","title":"Ways to contribute","text":"<p>We welcome many types of contributions including:</p> <ul> <li>New features;</li> <li>Builds, CI/CD changes;</li> <li>Bug fixes;</li> <li>Documentation;</li> <li>Issue Triage;</li> <li>Answering questions on Github Discussions;</li> <li>Communications / Social Media / Blog Posts;</li> <li>Events participation;</li> <li>Release management;</li> </ul> <p>For more details on development contributions, please refer to the \"Developer Guide\" section on the documentation site.</p>"},{"location":"about/contributing/#raising-issues","title":"Raising Issues","text":"<p>When you want to raise an issue, use GitHub Issues.</p> <p>If you are trying to report a vulnerability, please make sure to read the security policy.</p>"},{"location":"about/license/","title":"License","text":"<p>The Paas Operator is being made available under the European Union Public License (EUPL) v1.2, which is available in multiple languages.</p> <p>For your convenience, you can find the full, english language version below.</p> <pre><code>                  EUROPEAN UNION PUBLIC LICENCE v. 1.2\n                  EUPL \u00a9 the European Union 2007, 2016\n</code></pre> <p>This European Union Public Licence (the \u2018EUPL\u2019) applies to the Work (as defined below) which is provided under the terms of this Licence. Any use of the Work, other than as authorised under this Licence is prohibited (to the extent such use is covered by a right of the copyright holder of the Work).</p> <p>The Work is provided under the terms of this Licence when the Licensor (as defined below) has placed the following notice immediately following the copyright notice for the Work:</p> <pre><code>    Licensed under the EUPL\n</code></pre> <p>or has expressed by any other means his willingness to license under the EUPL.</p> <ol> <li>Definitions</li> </ol> <p>In this Licence, the following terms have the following meaning:</p> <ul> <li> <p>\u2018The Licence\u2019: this Licence.</p> </li> <li> <p>\u2018The Original Work\u2019: the work or software distributed or communicated by the   Licensor under this Licence, available as Source Code and also as Executable   Code as the case may be.</p> </li> <li> <p>\u2018Derivative Works\u2019: the works or software that could be created by the   Licensee, based upon the Original Work or modifications thereof. This   Licence does not define the extent of modification or dependence on the   Original Work required in order to classify a work as a Derivative Work;   this extent is determined by copyright law applicable in the country   mentioned in Article 15.</p> </li> <li> <p>\u2018The Work\u2019: the Original Work or its Derivative Works.</p> </li> <li> <p>\u2018The Source Code\u2019: the human-readable form of the Work which is the most   convenient for people to study and modify.</p> </li> <li> <p>\u2018The Executable Code\u2019: any code which has generally been compiled and which   is meant to be interpreted by a computer as a program.</p> </li> <li> <p>\u2018The Licensor\u2019: the natural or legal person that distributes or communicates   the Work under the Licence.</p> </li> <li> <p>\u2018Contributor(s)\u2019: any natural or legal person who modifies the Work under   the Licence, or otherwise contributes to the creation of a Derivative Work.</p> </li> <li> <p>\u2018The Licensee\u2019 or \u2018You\u2019: any natural or legal person who makes any usage of   the Work under the terms of the Licence.</p> </li> <li> <p>\u2018Distribution\u2019 or \u2018Communication\u2019: any act of selling, giving, lending,   renting, distributing, communicating, transmitting, or otherwise making   available, online or offline, copies of the Work or providing access to its   essential functionalities at the disposal of any other natural or legal   person.</p> </li> <li> <p>Scope of the rights granted by the Licence</p> </li> </ul> <p>The Licensor hereby grants You a worldwide, royalty-free, non-exclusive, sublicensable licence to do the following, for the duration of copyright vested in the Original Work:</p> <ul> <li>use the Work in any circumstance and for all usage,</li> <li>reproduce the Work,</li> <li>modify the Work, and make Derivative Works based upon the Work,</li> <li>communicate to the public, including the right to make available or display   the Work or copies thereof to the public and perform publicly, as the case   may be, the Work,</li> <li>distribute the Work or copies thereof,</li> <li>lend and rent the Work or copies thereof,</li> <li>sublicense rights in the Work or copies thereof.</li> </ul> <p>Those rights can be exercised on any media, supports and formats, whether now known or later invented, as far as the applicable law permits so.</p> <p>In the countries where moral rights apply, the Licensor waives his right to exercise his moral right to the extent allowed by law in order to make effective the licence of the economic rights here above listed.</p> <p>The Licensor grants to the Licensee royalty-free, non-exclusive usage rights to any patents held by the Licensor, to the extent necessary to make use of the rights granted on the Work under this Licence.</p> <ol> <li>Communication of the Source Code</li> </ol> <p>The Licensor may provide the Work either in its Source Code form, or as Executable Code. If the Work is provided as Executable Code, the Licensor provides in addition a machine-readable copy of the Source Code of the Work along with each copy of the Work that the Licensor distributes or indicates, in a notice following the copyright notice attached to the Work, a repository where the Source Code is easily and freely accessible for as long as the Licensor continues to distribute or communicate the Work.</p> <ol> <li>Limitations on copyright</li> </ol> <p>Nothing in this Licence is intended to deprive the Licensee of the benefits from any exception or limitation to the exclusive rights of the rights owners in the Work, of the exhaustion of those rights or of other applicable limitations thereto.</p> <ol> <li>Obligations of the Licensee</li> </ol> <p>The grant of the rights mentioned above is subject to some restrictions and obligations imposed on the Licensee. Those obligations are the following:</p> <p>Attribution right: The Licensee shall keep intact all copyright, patent or trademarks notices and all notices that refer to the Licence and to the disclaimer of warranties. The Licensee must include a copy of such notices and a copy of the Licence with every copy of the Work he/she distributes or communicates. The Licensee must cause any Derivative Work to carry prominent notices stating that the Work has been modified and the date of modification.</p> <p>Copyleft clause: If the Licensee distributes or communicates copies of the Original Works or Derivative Works, this Distribution or Communication will be done under the terms of this Licence or of a later version of this Licence unless the Original Work is expressly distributed only under this version of the Licence \u2014 for example by communicating \u2018EUPL v. 1.2 only\u2019. The Licensee (becoming Licensor) cannot offer or impose any additional terms or conditions on the Work or Derivative Work that alter or restrict the terms of the Licence.</p> <p>Compatibility clause: If the Licensee Distributes or Communicates Derivative Works or copies thereof based upon both the Work and another work licensed under a Compatible Licence, this Distribution or Communication can be done under the terms of this Compatible Licence. For the sake of this clause, \u2018Compatible Licence\u2019 refers to the licences listed in the appendix attached to this Licence. Should the Licensee's obligations under the Compatible Licence conflict with his/her obligations under this Licence, the obligations of the Compatible Licence shall prevail.</p> <p>Provision of Source Code: When distributing or communicating copies of the Work, the Licensee will provide a machine-readable copy of the Source Code or indicate a repository where this Source will be easily and freely available for as long as the Licensee continues to distribute or communicate the Work.</p> <p>Legal Protection: This Licence does not grant permission to use the trade names, trademarks, service marks, or names of the Licensor, except as required for reasonable and customary use in describing the origin of the Work and reproducing the content of the copyright notice.</p> <ol> <li>Chain of Authorship</li> </ol> <p>The original Licensor warrants that the copyright in the Original Work granted hereunder is owned by him/her or licensed to him/her and that he/she has the power and authority to grant the Licence.</p> <p>Each Contributor warrants that the copyright in the modifications he/she brings to the Work are owned by him/her or licensed to him/her and that he/she has the power and authority to grant the Licence.</p> <p>Each time You accept the Licence, the original Licensor and subsequent Contributors grant You a licence to their contributions to the Work, under the terms of this Licence.</p> <ol> <li>Disclaimer of Warranty</li> </ol> <p>The Work is a work in progress, which is continuously improved by numerous Contributors. It is not a finished work and may therefore contain defects or \u2018bugs\u2019 inherent to this type of development.</p> <p>For the above reason, the Work is provided under the Licence on an \u2018as is\u2019 basis and without warranties of any kind concerning the Work, including without limitation merchantability, fitness for a particular purpose, absence of defects or errors, accuracy, non-infringement of intellectual property rights other than copyright as stated in Article 6 of this Licence.</p> <p>This disclaimer of warranty is an essential part of the Licence and a condition for the grant of any rights to the Work.</p> <ol> <li>Disclaimer of Liability</li> </ol> <p>Except in the cases of wilful misconduct or damages directly caused to natural persons, the Licensor will in no event be liable for any direct or indirect, material or moral, damages of any kind, arising out of the Licence or of the use of the Work, including without limitation, damages for loss of goodwill, work stoppage, computer failure or malfunction, loss of data or any commercial damage, even if the Licensor has been advised of the possibility of such damage. However, the Licensor will be liable under statutory product liability laws as far such laws apply to the Work.</p> <ol> <li>Additional agreements</li> </ol> <p>While distributing the Work, You may choose to conclude an additional agreement, defining obligations or services consistent with this Licence. However, if accepting obligations, You may act only on your own behalf and on your sole responsibility, not on behalf of the original Licensor or any other Contributor, and only if You agree to indemnify, defend, and hold each Contributor harmless for any liability incurred by, or claims asserted against such Contributor by the fact You have accepted any warranty or additional liability.</p> <ol> <li>Acceptance of the Licence</li> </ol> <p>The provisions of this Licence can be accepted by clicking on an icon \u2018I agree\u2019 placed under the bottom of a window displaying the text of this Licence or by affirming consent in any other similar way, in accordance with the rules of applicable law. Clicking on that icon indicates your clear and irrevocable acceptance of this Licence and all of its terms and conditions.</p> <p>Similarly, you irrevocably accept this Licence and all of its terms and conditions by exercising any rights granted to You by Article 2 of this Licence, such as the use of the Work, the creation by You of a Derivative Work or the Distribution or Communication by You of the Work or copies thereof.</p> <ol> <li>Information to the public</li> </ol> <p>In case of any Distribution or Communication of the Work by means of electronic communication by You (for example, by offering to download the Work from a remote location) the distribution channel or media (for example, a website) must at least provide to the public the information requested by the applicable law regarding the Licensor, the Licence and the way it may be accessible, concluded, stored and reproduced by the Licensee.</p> <ol> <li>Termination of the Licence</li> </ol> <p>The Licence and the rights granted hereunder will terminate automatically upon any breach by the Licensee of the terms of the Licence.</p> <p>Such a termination will not terminate the licences of any person who has received the Work from the Licensee under the Licence, provided such persons remain in full compliance with the Licence.</p> <ol> <li>Miscellaneous</li> </ol> <p>Without prejudice of Article 9 above, the Licence represents the complete agreement between the Parties as to the Work.</p> <p>If any provision of the Licence is invalid or unenforceable under applicable law, this will not affect the validity or enforceability of the Licence as a whole. Such provision will be construed or reformed so as necessary to make it valid and enforceable.</p> <p>The European Commission may publish other linguistic versions or new versions of this Licence or updated versions of the Appendix, so far this is required and reasonable, without reducing the scope of the rights granted by the Licence. New versions of the Licence will be published with a unique version number.</p> <p>All linguistic versions of this Licence, approved by the European Commission, have identical value. Parties can take advantage of the linguistic version of their choice.</p> <ol> <li>Jurisdiction</li> </ol> <p>Without prejudice to specific agreement between parties,</p> <ul> <li> <p>any litigation resulting from the interpretation of this License, arising   between the European Union institutions, bodies, offices or agencies, as a   Licensor, and any Licensee, will be subject to the jurisdiction of the Court   of Justice of the European Union, as laid down in article 272 of the Treaty   on the Functioning of the European Union,</p> </li> <li> <p>any litigation arising between other parties and resulting from the   interpretation of this License, will be subject to the exclusive   jurisdiction of the competent court where the Licensor resides or conducts   its primary business.</p> </li> <li> <p>Applicable Law</p> </li> </ul> <p>Without prejudice to specific agreement between parties,</p> <ul> <li> <p>this Licence shall be governed by the law of the European Union Member State   where the Licensor has his seat, resides or has his registered office,</p> </li> <li> <p>this licence shall be governed by Belgian law if the Licensor has no seat,   residence or registered office inside a European Union Member State.</p> </li> </ul> <p>Appendix</p> <p>\u2018Compatible Licences\u2019 according to Article 5 EUPL are:</p> <ul> <li>GNU General Public License (GPL) v. 2, v. 3</li> <li>GNU Affero General Public License (AGPL) v. 3</li> <li>Open Software License (OSL) v. 2.1, v. 3.0</li> <li>Eclipse Public License (EPL) v. 1.0</li> <li>CeCILL v. 2.0, v. 2.1</li> <li>Mozilla Public Licence (MPL) v. 2</li> <li>GNU Lesser General Public Licence (LGPL) v. 2.1, v. 3</li> <li>Creative Commons Attribution-ShareAlike v. 3.0 Unported (CC BY-SA 3.0) for   works other than software</li> <li>European Union Public Licence (EUPL) v. 1.1, v. 1.2</li> <li>Qu\u00e9bec Free and Open-Source Licence \u2014 Reciprocity (LiLiQ-R) or Strong   Reciprocity (LiLiQ-R+).</li> </ul> <p>The European Commission may update this Appendix to later versions of the above licences without producing a new version of the EUPL, as long as they provide the rights granted in Article 2 of this Licence and protect the covered Source Code from exclusive appropriation.</p> <p>All other changes or additions to this Appendix require the production of a new EUPL version.</p>"},{"location":"administrators-guide/capabilities/","title":"Configuring capabilities","text":"<p>The Paas Operator can deliver capabilities to enable Paas deployments with CI and CD options with a one-click option. Some examples of capabilities include:</p> <ul> <li>enabling ArgoCD for Continuous Delivery on your Paas namespaces</li> <li>enabling tekton for Continuous Integration of your application components</li> <li>observing your Paas resources with Grafana</li> <li>configuring federated Authentication and Authorization with keycloak</li> </ul> <p>Adding capabilities does not require code changes / building new images. It only requires:</p> <ol> <li>a git repository for the cluster-wide ArgoCD to be used for deploying the capability for a Paas which has the capability enabled</li> <li>an ApplicationSet in the namespace of the cluster-wide ArgoCD to point to the git repository</li> <li>configuration for the Paas operator pointing to the ApplicationSet and specifying default quota to be used when no quota is specified for this capability in the Paas</li> </ol>"},{"location":"administrators-guide/capabilities/#configuring-the-applicationset","title":"Configuring the ApplicationSet","text":"<p>Cluster administrators can configure the ApplicationSet to be used for this specific capability. Imagine a cluster-wide ArgoCD to manage capabilities for Paas'es. It is deployed in the namespace <code>paas-capabilities-argocd</code>. To enable any capability, <code>spec.clusterwide_argocd_namespace</code> needs to be set to <code>paas-capabilities-argocd</code>, so that the Paas operator will locate ApplicationSets for capabilities in this namespace. And for a new capability (e.a. <code>new-capability</code>), there should be an ApplicationSet to manage resources for this new capability. This ApplicationSet should be created in <code>paas-capabilities-argocd</code>, and it's name (e.a. <code>new-capability</code>) should be configured in PaasConfig (<code>spec.capabilities[\"new-capability\"].ApplicationSet</code>). After setting this configuration, for every Paas with the capability <code>new-capability</code> enabled, the Paas operator will <code>GET</code> the ApplicationSet <code>paas-capabilities-argocd.new-capability</code>, add the Paas to the list generator and update the ApplicationSet definition.. This in turn will create a new Application for the capability for this Paas, and ArgoCD will create and manage the resources.</p>"},{"location":"administrators-guide/capabilities/#example-applicationset","title":"Example ApplicationSet","text":"<p>Example</p> <pre><code>apiVersion: argoproj.io/v1alpha1\nkind: ApplicationSet\nmetadata:\n  name: mycap-as\n  namespace: paas-capabilities-argocd\nspec:\n  generators: []\n  template:\n    metadata:\n      name: '{{paas}}-capability-mycap'\n    spec:\n      destination:\n        namespace: '{{paas}}-mycap'\n        server: 'https://kubernetes.default.svc'\n      project: '{{paas}}'\n      source:\n        kustomize:\n          commonLabels:\n            capability: mycap\n            clusterquotagroup: '{{requestor}}'\n            paas: '{{paas}}'\n            service: '{{service}}'\n            subservice: '{{subservice}}'\n            key: '{{my-custom-key}}'\n            revision: '{{my-custom-revision}}'\n        path: paas-capabilities/mycap\n        repoURL: 'https://www.github.com/belastingdienst/opr-paas-capabilities.git'\n        targetRevision: main\n      syncPolicy:\n        automated:\n          selfHeal: true\n</code></pre>"},{"location":"administrators-guide/capabilities/#configuring-quota","title":"Configuring quota","text":"<p>For every Capabilities for every Paas, a separate ClusterResourceQuota is created. Quotas can be set in a Paas, and when not set, the Capability configuration can have a Default which will be used instead. Furthermore, the capability configuration can also have a min and max value set. The Paas operator will use the value as set in the Paas, and these Default, Min and Max settings to come to the proper value to be set in the ClusterResourceQuota set on the namespace. Beyond these options, a capability can also be configured to use cluster-wide Quota with the <code>spec.capabilities[\"new-capability\"].quotas.clusterwide</code> and <code>spec.capabilities[\"new-capability\"].quotas.raio</code>.</p>"},{"location":"administrators-guide/capabilities/#more-info","title":"More info","text":"<p>For more information please check:</p> <ul> <li>administrators-guide's Cluster Wide Quotas section</li> <li>api-guide on capability quota configuration</li> <li>api-guide on capability quota in the Paas</li> </ul>"},{"location":"administrators-guide/capabilities/#configuring-permissions","title":"Configuring permissions","text":"<p>For every capability the Paas operator can grant permissions to service accounts. There are two options:</p> <ul> <li>Default permissions: These permissions are granted for this capability for every Paas</li> <li>Extra permissions: These permissions are granted only when a Paas has set <code>spec.capabilities[capability].extra_permissions</code> to true   The main goal for extra permissions is to start off with higher permissions to get started, and revert them when a lower permissive option is available (e.a. lower permissions are set as default permissions).   Customers starting with extra permissions can test with default permissions and return to extra permissions if they run into issues.</li> </ul>"},{"location":"administrators-guide/capabilities/#more-info_1","title":"More info","text":"<p>For more information on Default permissions and Extra permissions please revert to:</p> <ul> <li>Example PaasConfig with a capability</li> <li>api-guide on capability configuration in the PaasConfig</li> <li>api-guide on capability configuration in the Paas</li> </ul>"},{"location":"administrators-guide/capabilities/#configuring-custom-fields","title":"Configuring custom fields","text":"<p>Capabilities might require options to be set in a Paas. The fields to be set would be specific to a capability. Some examples include:</p> <ul> <li>setting a git url, revision and path for a ArgoCD bootstrap application</li> <li>setting a version for the keycloak capability</li> <li>deploying multiple streams of a capability and allowing some DevOps teams to run a <code>latest</code> while others run a <code>stable</code> stream</li> </ul> <p>For this reason we have introduced options for setting custom fields in the capability configuration in PaasConfig. Each custom field belongs to a capability (e.a. <code>capability_name</code>), has a field name (e.a. <code>custom_field_name</code>) and configuration. A custom field can be defined in PaasConfig in <code>PaasConfig.spec.capabilities[capability].customfields</code>).</p> <p>The following configuration can be set:</p> <ul> <li>validation: A regular expression used to validate input in a Paas</li> <li>required: When set to true, an error is returned when the custom field is not defined in a Paas</li> <li>default: When set, a Paas without the custom field set will use this default instead.</li> </ul> <p>** note: <code>required</code> and <code>default</code> are mutually exclusive.</p> <p>When set, a Paas can set these custom_fields, which brings them to the generators field in the Application created by the ApplicationSet for this specific Paas.</p>"},{"location":"administrators-guide/capabilities/#example-of-how-a-custom-field-operates","title":"Example of how a custom field operates","text":"<p>Image than on a cluster with</p> <ul> <li>a PaasConfig as defined in Example PaasConfig with a capability, and</li> <li>an ApplicationSet as defined in Example capability ApplicationSet,   a DevOps engineer created a Paas with a content like:</li> </ul> <p>Example</p> <pre><code>apiVersion: cpet.belastingdienst.nl/v1alpha1\nkind: Paas\nmetadata:\n  name: my-paas\nspec:\n  capabilities:\n    mycap:\n      custom_fields:\n        my-custom-key: key_123\n  ...\n</code></pre> <p>The following would happen:</p> <ul> <li>The Paas operator would check all custom_fields and use the following field values:</li> <li>my-custom-key: key_123</li> <li>my-custom-revision main</li> <li>The Paas operator would create an entry in the list generator in the ApplicationSet, with custom fields set as elements</li> <li>The cluster-wide ArgoCD ApplicationSet controller would create a new application for my-paas-capability-mycap</li> <li>the new application would have the following set in <code>spec.source.kustomize.commonLabels</code>:</li> <li>key: key_123</li> <li>revision: main</li> <li>From here, kustomize could use these values to be set on all resources create by the cluster-wide ArgoCD for this capability for this Paas</li> </ul>"},{"location":"administrators-guide/capabilities/#more-info_2","title":"More info","text":"<p>For more information on Custom Fields please revert to:</p> <ul> <li>Example PaasConfig with a capability</li> <li>Example capability ApplicationSet with custom_fields being set as commonLabels</li> <li>api-guide on capability configuration in the PaasConfig</li> <li>api-guide on capability configuration in the Paas</li> </ul>"},{"location":"administrators-guide/capabilities/#configuring-capabilities-in-the-paasconfig","title":"Configuring capabilities in the PaasConfig","text":"<p>On every cluster running the Paas operator, a PaasConfig resource is defined. This PaasConfig resource holds the specific configuration for the operator. For each capability a chapter needs to be set in <code>spec.capabilities</code>. An example can be found below. Furthermore, the Paas operator needs to know the namespace where to search for ApplicationSets managing the capability (<code>spec.clusterwide_argocd_namespace</code>).</p>"},{"location":"administrators-guide/capabilities/#example-paasconfig-with-a-capability","title":"Example PaasConfig with a capability","text":"<p>Below example shows all configuration required to configure a capability.</p> <p>Example</p> <pre><code>apiVersion: cpet.belastingdienst.nl/v1alpha1\nkind: PaasConfig\nmetadata:\n  name: opr-paas-config\nspec:\n  clusterwide_argocd_namespace: paas-capabilities-argocd\n  capabilities:\n    mycap:\n      ApplicationSet: mycap-as\n      default_permissions:\n        my-service-account:\n          - my-cluster-role\n      extra_permissions:\n        my-extra-service-account:\n          - my-extra-cluster-role\n      custom_fields:\n        my-custom-key:\n          validation: '^key_[0-9]+$'\n          required: true\n        my-custom-revision:\n          validation: '^(main|develop|feature-.*)$'\n          default: main\n      quotas:\n        clusterwide: true\n        defaults:\n          limits.cpu: \"8\"\n          limits.memory: 8Gi\n          requests.cpu: \"4\"\n          requests.memory: 5Gi\n          requests.storage: \"5Gi\"\n        min:\n          limits.cpu: \"1\"\n          limits.memory: 1Gi\n          requests.cpu: \"500Mi\"\n          requests.memory: 500Mi\n        max:\n          limits.cpu: \"16\"\n          limits.memory: 16Gi\n          requests.cpu: \"16\"\n          requests.memory: 16Gi\n          requests.storage: \"10Gi\"\n          thin.storageclass.storage.k8s.io/persistentvolumeclaims: \"0\"\n        ratio: 10\n</code></pre>"},{"location":"administrators-guide/configuration/","title":"Configuring the operator","text":"<p>The Paas Operator is configured using a Custom Resource Definition (CRD) called PaasConfig.</p>"},{"location":"administrators-guide/configuration/#paasconfig","title":"PaasConfig","text":"<p>Administrators can create a resource of kind PaasConfig in order to configure the Paas Operator. The operator will only use a single instance and when adding multiple PaasConfig instances, they will be ignored.</p> <p>The operator will do its best to prevent incorrect configurations from being loaded through a combination of CRD spec level validation and custom verification checks.</p> <p>For details on the layout of a PaasConfig resource, please see the development-guide's api section and more specifically the section on PaasConfigSpec.</p> <p>Alternatively, if you prefer, you could use doc.crds.dev.</p> <p>For an example, see below.</p>"},{"location":"administrators-guide/configuration/#example-paasconfig","title":"Example PaasConfig","text":"<p>Example</p> <pre><code>apiVersion: cpet.belastingdienst.nl/v1alpha1\nkind: PaasConfig\nmetadata:\n  name: opr-paas-config\nspec:\n  debug: false\n  groupsynclist:\n    namespace: chp-cronjobs\n    name: groupsynclist\n  ldap:\n    host: ${PROD_LDAP_HOST}\n    port: 636\n  argopermissions:\n    resource_name: argo-service\n    role: admin\n    header: |\n      g, system:cluster-admins, role:admin\n      g, something_clusteradmin, role:admin\n      g, something, role:admin\n  managed_by_label: argocd.argoproj.io/managed-by\n  requestor_label: level-one-support\n  decryptKeyPaths:\n    - /secrets/paas\n  clusterwide_argocd_namespace: prod-argocd\n  exclude_appset_name: something-to-be-excluded\n  quota_label: clusterquotagroup\n  rolemappings:\n    default:\n      - admin\n    edit:\n      - edit\n    view:\n      - view\n    admin:\n      - admin\n  capabilities:\n    argocd:\n      applicationset: prod-paas-argocd\n      default_permissions:\n        argocd-argocd-application-controller:\n          - monitoring-edit\n          - alert-routing-edit\n      custom_fields:\n        git_url:\n          validation: '^ssh:\\/\\/git@scm\\/[a-zA-Z0-9-.\\/]*.git$'\n          required: true\n        git_revision:\n          default: main\n        git_path:\n          default: '.'\n          validation: '^[a-zA-Z0-9.\\/]*$'\n      extra_permissions: {}\n      quotas:\n        clusterwide: false\n        defaults:\n          limits.cpu: \"8\"\n          limits.memory: 8Gi\n          requests.cpu: \"4\"\n          requests.memory: 5Gi\n          requests.storage: \"5Gi\"\n          thin.storageclass.storage.k8s.io/persistentvolumeclaims: \"0\"\n        min: {}\n        max: {}\n        ratio: 0\n    grafana:\n      applicationset: prod-paas-grafana\n      default_permissions: {}\n      extra_permissions: {}\n      quotas:\n        clusterwide: false\n        defaults:\n          limits.cpu: \"2\"\n          limits.memory: 3Gi\n          requests.cpu: \"1\"\n          requests.memory: 1Gi\n          requests.storage: \"2Gi\"\n          thin.storageclass.storage.k8s.io/persistentvolumeclaims: \"0\"\n        min: {}\n        max: {}\n        ratio: 0\n    tekton:\n      applicationset: prod-paas-tekton\n      default_permissions:\n        pipeline:\n          - monitoring-edit\n          - alert-routing-edit\n      extra_permissions: {}\n      quotas:\n        clusterwide: true\n        defaults:\n          limits.cpu: \"5\"\n          limits.memory: 8Gi\n          requests.cpu: \"1\"\n          requests.memory: 2Gi\n          requests.storage: \"100Gi\"\n          thin.storageclass.storage.k8s.io/persistentvolumeclaims: \"0\"\n        min: {}\n        max: {}\n        ratio: 10\n    sso:\n      applicationset: prod-paas-sso\n      default_permissions: {}\n      extra_permissions: {}\n      quotas:\n        clusterwide: false\n        defaults:\n          limits.cpu: \"4\"\n          limits.memory: 4Gi\n          requests.cpu: \"2\"\n          requests.memory: 2Gi\n          requests.storage: \"5Gi\"\n          thin.storageclass.storage.k8s.io/persistentvolumeclaims: \"0\"\n        min: {}\n        max: {}\n        ratio: 0\n</code></pre>"},{"location":"administrators-guide/install/","title":"Introduction","text":"<p>Deploy the operator using the following command:</p> <pre><code>kubectl apply -f https://github.com/belastingdienst/opr-paas/releases/latest/download/install.yaml\nkubectl apply -f https://raw.githubusercontent.com/belastingdienst/opr-paas/refs/heads/main/examples/resources/_v1alpha1_paasconfig.yaml\n</code></pre> <p>The second command will load an example PaasConfig resource from the main branch to get you going. Feel free to replace this with your own or a release specific version instead.</p> <p>This will install the operator using the <code>install.yaml</code> that was generated for the latest release. It will create:</p> <ul> <li>a namespace called <code>paas-system</code>;</li> <li>2 CRDs (<code>Paas</code> and <code>PaasNs</code>);</li> <li>a service account, role, role binding, cluster role &amp; cluster role binding for   all permissions required by the operator; As the operator binds role for others the serviceaccount gets the: <code>bind</code> permission.   It is advised to follow the principle of least privilege and scope the <code>permission</code> to only allow binding of the roles set in your   operator config by setting <code>resourcesNames</code> in your role.yaml</li> <li>a viewer &amp; an editor cluster role for Paas and PaasNs resources;</li> <li>a configmap with all operator configuration options;</li> <li>a deployment running the operator;</li> </ul> <p>Feel free to change config as required.</p>"},{"location":"administrators-guide/security/","title":"Introduction","text":"<p>For any piece of software, security is of paramount concern. With the Paas operator, we aim to provide safe, secure and sane defaults for our settings. If you have any improvements you'd like to share, feel free to create an issue or a pull request (PR) in our source code repository.</p> <p>For more information on contributing to this project, please see the Contributing section, Developers Guide section in this documentation and the <code>CONTRIBUTING.md</code> file in the root of our source code repository.</p> <p>Should you find a security issue, please refer to the Raising security issues section.</p>"},{"location":"administrators-guide/security/#things-to-be-aware-of","title":"Things to be aware of","text":""},{"location":"administrators-guide/security/#automount-is-set-to-true","title":"Automount is set to true","text":"<p>The operator makes use of a service account token that is used to communicate with the Kubernetes APIs. This service account token is automatically mounted using K8S's automount feature.</p> <p>It is a common best-practice for normal pods to opt-out of automatically mounting a service account token using <code>automountServiceAccountToken: false</code>.</p> <p>However, since this concerns an operator that needs the service account for most things it does, we have opted to keep the token auto-mounted.</p>"},{"location":"administrators-guide/cluster-wide-quotas/basic-usage/","title":"Basic usage of CWQs","text":"<p>With Cluster Wide Quotas, cluster admins can bring all resources for all Paas'es  belonging to a capability together in one cluster wide resource pool. This brings down over commit at the expense of the risks associated with resource sharing.</p>"},{"location":"administrators-guide/cluster-wide-quotas/basic-usage/#use-a-quota-per-paas","title":"Use a quota per Paas","text":"<p>Set:</p> <ul> <li><code>paasconfig.capabilities['tekton'].quotas.clusterwide</code> to <code>false</code></li> </ul>"},{"location":"administrators-guide/cluster-wide-quotas/basic-usage/#use-cwqs-with-one-hard-set-value","title":"Use CWQs with one hard-set value","text":"<p>You can use CWQs with a single hard-set value (e.a. 10).</p> <p>Set:</p> <ul> <li><code>paasconfig.capabilities['tekton'].quotas.clusterwide</code> to <code>true</code></li> <li><code>paasconfig.capabilities['tekton'].quotas.ratio</code> to <code>0</code></li> <li><code>paasconfig.capabilities['tekton'].quotas.min</code> to <code>10</code></li> </ul>"},{"location":"administrators-guide/cluster-wide-quotas/basic-usage/#use-cwqs-with-autoscaling","title":"Use CWQs with autoscaling","text":"<p>You can use cluster wide quotas with an autoscaling feature.</p> <p>For this example: every Paas is expected to use 1 CPU, and a minimum of 3 CPU should always be available. Additionally a maximum of 10 CPU can be reserved, and we scale down to 10% of normal usage.</p> <p>Set:</p> <ul> <li><code>paasconfig.capabilities['tekton'].quotas.clusterwide</code> to <code>true</code></li> <li><code>paasconfig.capabilities['tekton'].quotas.default</code> to <code>1</code></li> <li><code>paasconfig.capabilities['tekton'].quotas.default</code> to <code>1</code></li> <li><code>paasconfig.capabilities['tekton'].quotas.min</code> to <code>3</code></li> <li><code>paasconfig.capabilities['tekton'].quotas.max</code> to <code>10</code></li> <li><code>paasconfig.capabilities['tekton'].quotas.ratio</code> to <code>0.1</code> (10%)</li> </ul>"},{"location":"administrators-guide/cluster-wide-quotas/benefits/","title":"Benefits of using CWQs","text":"<p>The following is a good example of the benefits when implementing cluster wide quotas. The example makes use of Tekton.</p>"},{"location":"administrators-guide/cluster-wide-quotas/benefits/#without-cluster-wide-quotas","title":"Without Cluster Wide Quotas","text":"<p>Without Cluster Wide Quotas, every Tekton namespace would be linked to a specific cluster quota. All of these quota would add up to a considerable total quota reservation.</p> <p>However, since Tekton pipelines only rarely actually use these quotas on average about 99% of quota would always be unused. The cluster would either be considerably over committed or underutilized.</p>"},{"location":"administrators-guide/cluster-wide-quotas/benefits/#with-cluster-wide-quotas","title":"With Cluster Wide Quotas","text":"<p>By enabling Cluster Wide Quotas, all Tekton namespaces will be linked to one cluster wide quota.</p> <p>The Cluster Wide Quota can be automatically tuned by the Paas operator, having a minimum, maximum, default, and ratio value.</p> <p>The algorithm comes down to using the largest value out of 3 different calculations:</p> <ul> <li>ratio (Paas config) * sum of all Paas resources (either defined or default);</li> <li>sum of the largest two of all Paas quotas (either defined or defaulted);</li> <li>a hard set minimum (Paas config);</li> </ul> <p>Furthermore, a maximum value (Paas config) can be set to cap the quota.</p>"},{"location":"administrators-guide/cluster-wide-quotas/benefits/#example-with-numbers","title":"Example with numbers","text":"<p>Consider the following values being set in the Paas config (e.a. for <code>cpu.limits</code>):</p> cluster wide config min value 10 When set, every cluster wide quota has at least this amount. max value 20 When set, every cluster wide quota has at most this amount. default 5 Resources can be set in Paas. When not set in Paas, this default is used. ratio 0,3 Scales the sum of all quotas (all Paas'es) down to a lower value for cluster wide quota. <p>Now imagine that we would have a cluster where one by one new Paas'es would be created, with Tekton enabled, all using the default quota config.</p> <p>Quota reservations would be along lines of:</p> # of PAASes CWQ disabled Scale by ratio Scale with min values Scale with hardset min Scale with min &amp; max Savings 1 5 1,5 10,0 13,0 13,0 -8,0 2 10 3,0 10,0 13,0 13,0 -3,0 3 15 4,5 10,0 13,0 13,0 2,0 4 20 6,0 10,0 13,0 13,0 7,0 5 25 7,5 10,0 13,0 13,0 12,0 6 30 9,0 10,0 13,0 13,0 17,0 7 35 10,5 10,5 13,0 13,0 22,0 8 40 12,0 12,0 13,0 13,0 27,0 9 45 13,5 13,5 13,5 13,5 31,5 10 50 15,0 15,0 15,0 15,0 35,0 11 55 16,5 16,5 16,5 16,5 38,5 12 60 18,0 18,0 18,0 18,0 42,0 13 65 19,5 19,5 19,5 19,5 45,5 14 70 21,0 21,0 21,0 20,0 50,0 15 75 22,5 22,5 22,5 20,0 55,0 16 80 24,0 24,0 24,0 20,0 60,0 17 85 25,5 25,5 25,5 20,0 65,0 18 90 27,0 27,0 27,0 20,0 70,0 19 95 28,5 28,5 28,5 20,0 75,0 <p>Visualized in a graph, it would look like this:</p> <p></p> <p>Once 10 Paas'es would be created:</p> <ul> <li>without CWQ's, about 50 CPU limits would be reserved for all Tekton namespaces;</li> <li>with a ratio of 0.3 only 15 would be reserved, saving 35 CPU limits;</li> </ul> <p>Beyond 14 Paas'es, there would only be 20 CPU's reserved no matter how much Paas'es would be created.</p>"},{"location":"development-guide/","title":"Contributing to Paas source code","text":"<p>If you want to contribute to the source code of the Paas operator and innovate in the database in Kubernetes space, this is the right place. Welcome!</p> <p>We have a truly open source soul. That's why we welcome new contributors. Our goal is to enable you to become the next committer of Paas, by having a good set of docs that guide you through the development process. Having said this, we know that everything can always be improved, so if you think our documentation is not up to scratch, please let us know or provide a pull request based on your experience.</p>"},{"location":"development-guide/#development-workflow","title":"Development workflow","text":"<p>The Paas operator project follows trunk-based development, with the <code>main</code> branch representing the trunk.</p> <p>We adopt the \"Github Flow\" development workflow, with some customizations:</p> <ul> <li>the Continuous Delivery   branch is called <code>main</code> and is protected;</li> <li>Github is configured for linear development (no merge commits);</li> <li>development happens in separate branches created from the <code>main</code> branch and   called \"dev/ISSUE_ID\";</li> <li>once completed, developers must submit a pull request;</li> <li>reviews by two different maintainers are required before a pull request can be   merged;</li> </ul> <p>We also adopted the conventional commit format for commit messages.</p> <p>The roadmap is defined as a Github Project.</p> <p>Finally, we have an operational Kanban board we use to organize the flow of items.</p>"},{"location":"development-guide/#your-development-environment-for-paas","title":"Your development environment for Paas","text":"<p>In order to write even the simplest patch for Paas you must have setup your workstation to build and locally test the version of the operator you are developing.</p>"},{"location":"development-guide/#submit-a-pull-request","title":"Submit a pull request","text":"<p>First and foremost: as a potential contributor, your changes and ideas are welcome at any hour of the day or night, weekdays, weekends, and holidays. Please do not ever hesitate to ask a question or send a PR.</p> <p>IMPORTANT: before you submit a pull request, please read this document from the Istio documentation which contains very good insights and best practices: \"Writing Good Pull Requests\".</p> <p>If you have written code for an improvement to Paas or a bug fix, please follow this procedure to submit a pull request:</p> <ol> <li>Create a personal fork of the Paas Operator project;</li> <li>If there is a related issue, please leave a comment that you intend to work on it;</li> <li>Run the e2e tests in the forked repository, see our related documentation;</li> <li>Once development is finished, create a pull request from your forked project    to the Paas project;</li> </ol> <p>Please make sure the pull request title and message follow Conventional Commits For more details on submitting a PR, see \"Submitting A PR\".</p> <p>One of the maintainers will then proceed with the first review and approve the CI workflow to run in the Paas project.  The second reviewer will run end-to-end test against the changes in fork pull request. If testing passes, the pull request will be labeled with <code>ok-to-merge</code> and will be ready for merge.</p>"},{"location":"development-guide/#sign-your-work","title":"Sign your work","text":"<p>We use the Developer Certificate of Origin (DCO) as an additional safeguard for the Paas project. This is a well established and widely used mechanism to assure contributors have confirmed their right to license their contribution under the project's license.</p> <p>Please read https://developercertificate.org.</p> <p>If you can certify it, then just add a line to every git commit message:</p> <pre><code>  Signed-off-by: Random J Developer &lt;random@developer.example.org&gt;\n</code></pre> <p>or use the command <code>git commit -s -m \"commit message comes here\"</code> to sign-off on your commits.</p> <p>Use your real name (sorry, no pseudonyms or anonymous contributions). If you set your <code>user.name</code> and <code>user.email</code> git configs, you can sign your commit automatically with <code>git commit -s</code>.</p> <p>You can also use git aliases like <code>git config --global alias.ci 'commit -s'</code>. Now you can commit with <code>git ci</code> and the commit will be signed.</p>"},{"location":"development-guide/20_issues/","title":"Raising Issues","text":"<p>When raising issues, please specify the following:</p> <ul> <li>Setup details as specified in the issue template</li> <li>A scenario where the issue occurred (with details on how to reproduce it)</li> <li>Errors and log messages that are displayed by the involved software</li> <li>Any other detail that might be useful</li> </ul> <p>For security related issues, we have a dedicated security policy.</p>"},{"location":"development-guide/21_security-issues/","title":"Security Policy","text":"<p>The Dutch Tax Office (Dutch: Belastingdienst) takes the security of our products and services seriously.</p> <p>If you believe you have found a security vulnerability, please report it before sharing it with the outside world. This way, we can take measures first. This is called 'Coordinated Vulnerability Disclosure' (CVD).</p>"},{"location":"development-guide/21_security-issues/#reporting-security-issues","title":"Reporting Security Issues","text":"<p>Please do not report security vulnerabilities through public GitHub issues.</p> <p>The Coordinated Vulnerability Disclosure page on our webpage explains how to securely report your finding.</p> <p>In summary:</p> <ul> <li>Send us your findings by e-mail: cvd@belastingdienst.nl</li> <li>If possible, encrypt your findings with our PGP-key on the Coordinated Vulnerability Disclosure page.</li> <li>provide sufficient information to be able to reproduce the problem, so that we   can rectify this as quickly as possible. The URL of the system affected and a   description of the vulnerability are sufficient, but more information may be   required for more complex vulnerabilities.</li> <li>leave your contact details so that our Security Operations Centre can contact   you in order to jointly find a safe solution. Leave at least an e-mail address   or telephone number.</li> <li>do not share the information regarding the security problem with other people   until we have solved it.</li> <li>handle the information regarding the security problem responsibly by not performing   any actions that go further than necessary to demonstrate the security problem.</li> <li>realize that any information in our systems falls under the (fiscal) duty of   confidentiality and that further dissemination of the said information is a   punishable offense.</li> </ul>"},{"location":"development-guide/21_security-issues/#policy","title":"Policy","text":"<ul> <li>The Dutch Tax Office (Dutch: Belastingdienst) follows the principle of Coordinated Vulnerability Disclosure.</li> </ul>"},{"location":"development-guide/30_submitting-a-pr/","title":"Submitting a Pull Request","text":"<p>First and foremost: as a potential contributor, your changes and ideas are welcome at any hour of the day or night, weekdays, weekends, and holidays. Please do not ever hesitate to ask a question or send a PR.</p> <p>Tip</p> <p>Before you submit a pull request, please read this document from the Istio documentation which contains very good insights and best practices: \"Writing Good Pull Requests\".</p> <p>If you have written code for an improvement to Paas or a bug fix, please follow this procedure to submit a pull request:</p> <ol> <li>Create a fork of the Paas Operator project;</li> <li>Add a comment to the related issue to let us know you're working on it;</li> <li>Develop your feature or fix on your forked repository;</li> <li>Run the e2e tests in your forked repository, see our related e2e testing    documentation;</li> <li>Once development is finished, create a pull request from your forked project    to the Paas project.    Please make sure the pull request title and message follow Conventional Commits</li> </ol> <p>One of the maintainers will then proceed with the first review and approve the CI workflow to run in the Paas project.  The second reviewer will run end-to-end test against the changes in fork pull request. If testing passes, the pull request will be labeled with <code>ok-to-merge</code> and will be ready for merge.</p>"},{"location":"development-guide/30_submitting-a-pr/#sign-your-work","title":"Sign your work","text":"<p>We use the Developer Certificate of Origin (DCO) as an additional safeguard for the Paas project. This is a well established and widely used mechanism to assure contributors have confirmed their right to license their contribution under the project's license.</p> <p>Please read https://developercertificate.org.</p> <p>If you can certify it, then just add a line to every git commit message:</p> <p>Example</p> <pre><code>  Signed-off-by: Random J Developer &lt;random@developer.example.org&gt;\n</code></pre> <p>or use the command <code>git commit -s -m \"commit message comes here\"</code> to sign-off on your commits.</p> <p>Use your real name (sorry, no pseudonyms or anonymous contributions). If you set your <code>user.name</code> and <code>user.email</code> git configs, you can sign your commit automatically with <code>git commit -s</code>.</p> <p>You can also use git aliases like <code>git config --global alias.ci 'commit -s'</code>. Now you can commit with <code>git ci</code> and the commit will be signed.</p>"},{"location":"development-guide/31_writing-good-pull-request/","title":"Writing Good Pull Requests","text":"<p>Note</p> <p>The following text was shamelessly copied in full from the Istio project. The original lives at: https://github.com/istio/istio/wiki/Writing-Good-Pull-Requests</p> <p>The reason for including the text here, is that we really liked the content and did not want to run the risk of having a broken link / losing the content in the future should the original ever be moved or deleted.</p> <p>One of the biggest bottlenecks we have in Istio is PR reviews. By creating good PRs, you can help the reviewers go through your PR easily and get it checked-in quickly. This is a set of guidelines for creating good pull requests.</p> <ul> <li>Communicate beforehand<ul> <li>Open a tracking issue</li> <li>Use work-in-progress PRs for early feedback</li> </ul> </li> <li>Add a good explanation</li> <li>Keep it short</li> <li>Organize into commits</li> <li>Add tests!</li> <li>Tracking future work</li> </ul>"},{"location":"development-guide/31_writing-good-pull-request/#communicate-beforehand-ie-why-are-you-doing-this","title":"Communicate beforehand (i.e. why are you doing this?)","text":"<p>It's awful when a reviewer rejects your PR, or objects to your design. You now have to throw away your carefully crafted and authored PR and start over.</p> <p>If you communicate your intent for the change to the reviewer beforehand and agree on the design, there is much less of a chance of outright rejection of PRs, or substantial change requests. It also gives an opportunity for the reviewer to think about the problem and think about how the system behavior would change, before they start reviewing the code.</p>"},{"location":"development-guide/31_writing-good-pull-request/#open-a-tracking-issue","title":"Open a tracking issue","text":"<p>Unless the PR is trivial, it is a good idea to open a bug to track the issue first. Especially if this is for fixing a bug. This allows capturing more detailed analysis (and repro steps if this is a bug) separately. It can also be used to track multiple PRs against the same problem.</p>"},{"location":"development-guide/31_writing-good-pull-request/#use-work-in-progress-prs-for-early-feedback","title":"Use work-in-progress PRs for early feedback","text":"<p>A good way to communicate before investing too much time is to create a \"Work-in-progress\" PR and share it with your reviewers. The standard way of doing this is to add a \"WIP:\" prefix in your PR's title. This will let people looking at your PR know that it is not well baked yet. Our infrastructure also understands that the PR is not ready for merging yet, and will not allow accidental merging.</p>"},{"location":"development-guide/31_writing-good-pull-request/#add-a-good-explanation-ie-what-exactly-are-you-doing","title":"Add a good explanation (i.e. what exactly are you doing?)","text":"<p>If you just write a cryptic title and nothing else, there is not much to go with for the reviewer. The reviewer will need to reconstruct what you're trying to accomplish from your code, which is not an easy task.</p> <p>Writing a good, short, to the point explanation of what is going in your commits is extremely useful for the reviewer. If there are multiple things going on (i.e. a needed refactoring, a trivial bug fix you happened to catch along the way, an issue that you found for which you're adding a TODO for), add these as bullet-points in your PR description.</p> <p>This not only helps the reviewer, but also people that are looking at the repo history, trying to figure out what has changed in a particular pull request.</p> <p>Do:</p> <pre><code>Subject: Fix bug(#449) that causes Foo component to crash when flag is not set.\nDescription:\n+ This is caused by an off-by-one failure during iteration of nukes to launch.\n+ Also fixed a race condition by adding a lock on the trigger mechanism that caused concurrent launches that caused a crash in the silo.\n+ Adding a TODO for refactoring the code as well, as the cold war is over and we don't need this particular\ndefense mechanism anymore.\n</code></pre> <p>Don't</p> <pre><code>Subject: Fix minor bug.\nDescription:\n</code></pre>"},{"location":"development-guide/31_writing-good-pull-request/#keep-it-short","title":"Keep it short","text":"<p>The shorter the PR, the easier to review. Reviewing a PR requires the reviewer to understand how the system behavior is being changed. With bigger PRs, this becomes harder to understand, especially with the diff based nature of the review tools.</p> <p>Keep your PRs as short as possible. A good rule of thumb is that if you PR ends up touching more than 500 lines, you should considering breaking it up into smaller PRs.</p> <p>If there are refactorings that you've decided to do along the way, move them to a separate PR so that real changes aren't mingled with no-brainer refactoring changes.</p>"},{"location":"development-guide/31_writing-good-pull-request/#organize-into-commits","title":"Organize into commits","text":"<p>If you must merge large changes, all in one go, then consider splitting your changes into multiple commits within the same pull request. This allows the reviewer to compartmentalize your changes and review them in isolation.</p> <p>When making changes that are requested by your reviewers, add them as additional commits, instead of squashing it into the original. This allows the reviewer to quickly spot that his feedback is being incorporated.</p>"},{"location":"development-guide/31_writing-good-pull-request/#add-tests-ie-does-it-actually-work","title":"Add tests! (i.e. does it actually work?)","text":"<p>Whatever the issue you're fixing, add tests! Adding tests are the best way to convince the reviewer that what you're doing actually works. It also makes sure that the product will not regress and the issue will not occur again.</p> <p>It is crucial to add the right type of tests. If the issue you are fixing is due to a particular library (e.g. cache library race condition causing cache poisoning), it is perfectly reasonable to write a small unit-test to avoid the regression.</p> <p>However, if the issue is larger scoped (e.g. change in product behavior), then it is important to add the right integration or end-to-end test to verify the behavior.</p>"},{"location":"development-guide/31_writing-good-pull-request/#tracking-future-work","title":"Tracking future work","text":"<p>Sometimes in the course of a PR review, a reviewer will point out more work that should be done as part of the change. When this happens, it is common for the author of the PR to say \"Good idea, I'll do that in a follow-up PR\". As part of this, it's generally desirable for the author to open a new issue (assuming there isn't one already) to track this extra work. The issue # should be included in the original PR so that the reviewer can rest assured that the work will not be forgotten.</p>"},{"location":"development-guide/40_e2e-tests/","title":"Introduction","text":"<p>We have a bunch of end-to-end tests that can be used by you to verify whether the operator still works as expected after you made any code changes. These tests are also part of our continues integration pipeline on Github.</p>"},{"location":"development-guide/40_e2e-tests/#prerequisites","title":"Prerequisites","text":"<p>Ensure you have a vanilla Kubernetes or OpenShift cluster running. We can heartily recommend using kind.</p> <p>Example</p> <p><code>kind create cluster</code> </p>"},{"location":"development-guide/40_e2e-tests/#running-the-tests","title":"Running the tests","text":"<ol> <li>In case of a vanilla kubernetes cluster, run: <code>make setup-e2e</code>    This will apply mocks, etc. needed to run the operator.</li> <li>Start the operator: <code>make run-operator</code></li> <li>Finally, run the actual e2e tests: <code>make test-e2e</code></li> </ol>"},{"location":"development-guide/40_e2e-tests/#design-considerations","title":"Design considerations","text":"<p>We've decided to use the e2e-framework from K8S. The advantages of this framework are that any connection to a K8S cluster can be used to execute these tests against that cluster.</p> <p>This makes the tests loosely coupled, and thus usable against various types of clusters. For example a K3S cluster spun up on a developer's machine or in one in GitHub actions.</p> <p>We can use our favorite programming language to write the tests. The framework uses a kubernetes client to execute K8S commands to the connected cluster. The cluster should have a Paas operator installed to reconcile Paas'es during the execution of these tests. The tests assert whether the expected resources are created on the cluster.</p>"},{"location":"development-guide/40_e2e-tests/#setup","title":"Setup","text":"<p>The host running these tests, must have an active connection to a K8S cluster in it's kubeConfig. It must be logged in and have the appropriate permissions to apply the resources used in this test.</p> <p>The tests, by default, run in a namespace: <code>paas-e2e</code> which will be created during test setup (<code>main_test.go</code>) and deleted afterward. If you would like to use an existing namespace, set the environment variable: <code>PAAS_E2E_NS</code> to the namespace name.</p> <p>Info</p> <p>The tests do not create the custom namespace for you in case it happens to be missing, so make sure to create it or be prepared to enjoy the error message.</p>"},{"location":"development-guide/50_notes/","title":"Developer notes","text":"<ul> <li>Because of dependency issues we decided to use a stub instead of importing all   dependencies behind the original code of ArgoCD.</li> </ul> <p>More info in <code>internal/stubs/argocd/v1beta1</code></p>"},{"location":"development-guide/60_writing-documentation/","title":"Writing Documentation","text":"<p>Our project utilizes a structured approach to documentation to ensure clarity and ease of access for all users. All documentation is written in Markdown and stored within the <code>docs</code> directory of the repository. The first level of directories under <code>docs</code> corresponds to the main sections of our documentation site:</p> <ul> <li><code>overview</code></li> <li><code>administrators-guide</code></li> <li><code>user-guide</code></li> <li><code>development-guide</code></li> <li><code>about</code></li> </ul> <p>We use MkDocs along with the Material for MkDocs theme to generate a professional and user-friendly documentation site from this structure.</p>"},{"location":"development-guide/60_writing-documentation/#partially-generated-documentation","title":"Partially generated documentation","text":"<p>While most of the documentation is hand written by the core team or contributors, the API documentation in the development guide section is auto-generated using the <code>crd-ref-docs</code> tool from Elastic.</p> <p>This document is auto-generated by a Github Actions workflow so you should never need to do so manually.</p> <p>If for some reason you do need to, here is how.</p> <p>Assuming you're located in the root of the repository, execute the following to update the API document.</p> <pre><code>go install github.com/elastic/crd-ref-docs\ncrd-ref-docs --config=./crd-ref-docs-config.yml --source-path=./api --renderer=markdown --output-path=./docs/development-guide/00_api.md\n</code></pre>"},{"location":"development-guide/60_writing-documentation/#writing-clear-and-effective-documentation","title":"Writing Clear and Effective Documentation","text":"<p>When contributing to the documentation, please aim to keep your writing simple and factual. Clear and concise documentation helps users understand and utilize our project more effectively.</p>"},{"location":"development-guide/60_writing-documentation/#tips-for-writing-good-documentation","title":"Tips for Writing Good Documentation","text":"<p>Be Concise and Direct: Use straightforward language and get to the point quickly. Avoid unnecessary words or overly complex sentences.</p> <p>Use Active Voice: Write in active voice to make your writing more engaging and easier to understand. For example, we would prefer the use of \"Install the package using...\" over \"The package can be installed using...\".</p> <p>Organize Content Logically: Break down information into logical sections and use headings and subheadings to guide the reader. This makes it easier for users to find the information they need.</p> <p>Ensure that you place your documentation in the right sub-section for your intended reader.</p> <p>Use Lists and Bullet Points: When presenting multiple items or steps, use lists to improve readability.</p> <p>Include Examples and Call Outs: Provide code snippets or command-line examples where applicable to illustrate your points.</p> <p>Tip</p> <p>Use call outs like this to highlight important information. You can use \"note\", \"abstract\", \"info\", \"tip\", \"success\", \"question\", \"warning\", \"failure\", \"danger\", \"bug\", \"example\" and \"quote\".</p> <p>See the docs for more information.</p> <p>Maintain Consistent Formatting: Try to follow the existing style and formatting conventions used in the rest of the documentation. This includes heading styles, code block formatting, and emphasis.</p> <p>Proofread Your Work: Check for spelling and grammar errors before submitting. Reading your text aloud can help identify awkward phrasing or mistakes.</p> <p>By following these guidelines, you'll help maintain a high standard of quality in our documentation, making it a valuable resource for everyone involved in the project.</p>"},{"location":"development-guide/e2e-test-details/","title":"E2E test cases for opr-paas","text":"<p>Below you will find a list of features that we want to test using end-to-end testing. For each feature, the setup and the assessments are listed.</p>"},{"location":"development-guide/e2e-test-details/#paas","title":"Paas","text":"<p>What we test: CRUD for Paas</p> <p>Scenarios:</p> <ol> <li> <p>A <code>Paas</code> is created that already exists. Given that a specified <code>Paas</code> already exists, when someone configures a new <code>Paas</code> with the same name, then the <code>Paas</code> related namespace must not be created and the operator must return an error.</p> </li> <li> <p>A minimal <code>Paas</code> is created. Given that the <code>Paas</code> does not exist, when someone configures the minimal <code>Paas</code> then the <code>Paas</code> namespace must be created and the status of the <code>Paas</code> contains no errors.</p> </li> <li> <p>A <code>Paas</code> is renamed. Given that a specified <code>Paas</code> exists, when the <code>Paas</code> is renamed in the configuration, then the related <code>Paas</code> namespace must be renamed as well.</p> </li> <li> <p>A <code>Paas</code> is deleted. Given that a specified <code>Paas</code> exists, when the <code>Paas</code> is deleted, then the namespace belonging to the <code>Paas</code> is also removed.</p> </li> </ol> <p>Post scenarios: reset environment to clean slate.</p>"},{"location":"development-guide/e2e-test-details/#paasns","title":"PaasNs","text":"<p>What we test: CRUD for PaasNs</p> <p>Scenarios:</p> <ol> <li> <p>A <code>PaasNs</code> is created for a <code>Paas</code> that does not exist. Given that a specified <code>Paas</code> does not exist, when someone configures a <code>PaasNs</code> to be created under specified <code>Paas</code>, then the <code>PaasNs</code> related namespace must not be created and the status of said <code>PaasNs</code> must contain the correct error.</p> </li> <li> <p>A minimal <code>Paas</code> that is referenced in the <code>PaasNs</code> is created. Given that the <code>PaasNs</code> does not exist, and that the minimal <code>Paas</code> does not exist, when someone configures the minimal <code>Paas</code> and someone configures the <code>PaasNs</code> referencing the minimal <code>Paas</code> then the <code>PaasNS</code> namespace must be created and the <code>PaasNS</code> namespace has the <code>quota_label</code> label with the value of ... FIXME and the status of the <code>PaasNs</code> contains no errors.</p> </li> <li> <p>A <code>PaasNs</code> is renamed. Given that a specified <code>PaasNs</code> exists, when the <code>PaasNs</code> is renamed in the configuration, then the related <code>PaasNs</code> namespace must be renamed as well.</p> </li> <li> <p>A <code>PaasNs</code> is deleted. Given that a specified <code>PaasNs</code> exists, when the <code>PaasNs</code> is deleted, then the namespace belonging to the <code>PaasNs</code> is also removed.</p> </li> </ol> <p>Post scenarios: reset environment to clean slate.</p>"},{"location":"development-guide/e2e-test-details/#namespaces","title":"Namespaces","text":"<ol> <li> <p>A minimal <code>Paas</code> configuration without namespaces results in one namespace. Given a minimal <code>Paas</code> configuration without namespaces, when someone adds said configuration to the system, then a single namespace should have been created, and this namespace should be named the same as the <code>Paas</code>, and no <code>PaasNs</code>'s or there namespaces are linked to th <code>Paas</code>.</p> </li> <li> <p>Adding two namespaces to the <code>Paas</code>'s spec. Given a minimal <code>Paas</code> without any namespaces exists, when the <code>Paas</code> is updated by adding 2 namespaces to the spec, then one namespace with the same name as the <code>Paas</code> must exist, and two <code>PaasNs</code>'s must exist in the namespace of the <code>Paas</code>, and these <code>PaasNs</code>'s each have a namespace, and these <code>PaasNs</code> namespaces must be named according to their <code>spec.namespaces</code> entries, prefixed by the <code>Paas</code> namespace name</p> </li> <li> <p>Removing the namespaces from a <code>Paas</code>. Given a minimal <code>Paas</code> with two namespaces exists, when the <code>Paas</code> configuration is updated to remove the namespaces, then the <code>PaasNs</code>'s should have be removed from the <code>Paas</code> namespace, and the <code>Paas</code> namespace was removed.</p> </li> </ol> <p>Post scenarios: reset environment to clean slate.</p>"},{"location":"development-guide/e2e-test-details/#clusterresourcequotas","title":"ClusterResourceQuotas","text":"<p>What we test: CRQ CRUD</p> <p>Note</p> <p>The <code>spec.quota</code> does not fall under not cluster wide quotas, hence a separate set of test scenarios.</p> <ol> <li> <p>Ensure the correct CRQ is created for a <code>Paas</code>. Given a minimal <code>Paas</code> exists, when someone adds a quota to <code>spec.quota</code> for the <code>Paas</code> configuration, then a CRQ with the name of the <code>Paas</code> must be created, and <code>clusterquotagroup=</code> followed by the <code>Paas</code> name should have been applied    as label selector on the CRQ, and the size of the created CRQ equals the size as specified in the <code>spec.quota</code>.</p> </li> <li> <p>The <code>spec.quota</code> for a <code>Paas</code> is updated. Given a minimal <code>Paas</code> exists, and a valid CRQ exists for this <code>Paas</code>, when someone updates the <code>spec.quota</code> section for the specified <code>Paas</code> configuration, then the CRQ should be updated, and the size of the updated CRQ equals the size as specified in the <code>spec.quota</code>.</p> </li> <li> <p>Removing the <code>Paas</code> should remove the associated CRQ. Given a minimal <code>Paas</code> and its associated CRQ exist, when the <code>Paas</code> is removed, then the associated CRW with the name of the <code>Paas</code> should have removed as well.</p> </li> </ol> <p>Post scenarios: reset environment to clean slate.</p>"},{"location":"development-guide/e2e-test-details/#cluster-wide-quotas","title":"Cluster wide quotas","text":"<p>What we test: cluster wide quota CRUD</p> <p>Scenarios:</p> <p>TODO</p> <p>Post scenarios: reset environment to clean slate.</p>"},{"location":"development-guide/e2e-test-details/#groups-users","title":"Groups =&gt; Users","text":"<p>What we test: managing users and group memberships through <code>Paas</code> configuration.</p> <p>Scenarios:</p> <ol> <li> <p>Creating a group with a single user without a specified role. Given a minimal <code>Paas</code> with a single namespace, and a group with a single user without a specified role, when that <code>Paas</code> is created, then a <code>Group</code> was created with the correct name, and the user is a member of said group, and the correct labels were placed on the group, and the Owner Reference for the Group points to the correct Paas, and there are were no changes to the GroupSyncList, and the rolebinding on the namespace points to the group to the default role, and the rolebinding was not applied to the default <code>Paas</code> namespace (name of the <code>Paas</code>)</p> </li> <li> <p>Updating the <code>Paas</code>, adding a group with a role other than default. Given an existing, minimal <code>Paas</code> with a single namespace, when a group is added to said <code>Paas</code>, and said group has a specific role, other than default (see test_config), and a different user is a member of said group than in scenario 1, then a <code>Group</code> was created with the correct name, and the user is a member of said group, and the correct labels were placed on the group, and the Owner Reference for the Group points to the correct Paas, and there are were no changes to the GroupSyncList, and the rolebinding on the namespace points to the group to the default role, and the rolebinding was not applied to the default <code>Paas</code> namespace (name of the <code>Paas</code>)</p> </li> <li> <p>Removing the <code>Paas</code>. Given an existing <code>Paas</code> with a single group, when said <code>Paas</code> is removed,</p> </li> </ol> <p>Note</p> <p>There are known issues on groups, updating / removing does not go perfectly. Goal here is to test the baseline in the current situation.</p> <p>Determine what that baseline currently is.</p> <p>Post scenarios: reset environment to clean slate.</p>"},{"location":"development-guide/e2e-test-details/#groups-query","title":"Groups =&gt; Query","text":"<p>What we test: managing users and group memberships through an LDAP query specified in the <code>Paas</code> configuration.</p> <p>Scenarios:</p> <ol> <li>Minimal <code>Paas</code> with one namespace and a <code>Group</code> with a <code>Query</code> but no <code>Role</code>. Given no existing <code>Paas</code>, when a minimal <code>Paas</code> is created with a single namespace, and a <code>Group</code> with a <code>Query</code>, but without a <code>Role</code>, then a <code>Group</code> with the correct name should have been created, and there should be no users in said <code>Group</code>, and the correct labels were added onto the <code>Group</code>, and the Owner Reference for the Group points to the correct Paas, and the query was added to the groupsynclist, and the rolebinding on the namespace points to the group, to the specified role, and the rolebinding was not applied to the default <code>Paas</code> namespace (name of the <code>Paas</code>).</li> <li> <p>Updating the <code>Paas</code>, adding a group with a role other than default. Given an existing, minimal <code>Paas</code> with a single namespace, when another query is added to said <code>Paas</code> (compared to step scenario 1), and said group has a specific role, other than default (see test_config), then a <code>Group</code> was created with the correct name, and there are no users in said group, and the correct labels were placed on the group, (no ldap things) and the Owner Reference for the Group points to the correct Paas, and there were changes made to the GroupSyncList, and the rolebinding on the namespace points to the group to the specified role, and the rolebinding was not applied to the default <code>Paas</code> namespace (name of the <code>Paas</code>)</p> </li> <li> <p>Removing the <code>Paas</code>. Given an existing <code>Paas</code> with a single group, when said <code>Paas</code> is removed,</p> </li> </ol> <p>Note</p> <p>There are known issues on groups, updating / removing does not go perfectly. Goal here is to test the baseline in the current situation.</p> <p>Determine what that baseline currently is.</p> <p>Post scenarios: reset environment to clean slate.</p> <p>Note</p> <p>TODO, there a known issue regarding groups. Good regression test to model the following steps: 1. Create <code>Paas</code> with query; 2. Update <code>Paas</code> from step 1, remove query and add users to the group; 3. Group is not removed from groupsynclist; 4. Sync fails because the required <code>ldap.uid</code> doesn't match the groupname. (We don't fully test sync.)</p>"},{"location":"development-guide/e2e-test-details/#secrets","title":"Secrets","text":"<p>The capabilities are also used to test clusterwide quotas</p>"},{"location":"development-guide/e2e-test-details/#capability-argocd","title":"Capability ArgoCD","text":"<p>What we test: creating a <code>Paas</code> with the <code>ArgoCD</code> capability enabled.</p> <p>Scenarios:</p> <ol> <li> <p>A minimal <code>Paas</code> with ArgoCD capability enabled. Given a minimal <code>Paas</code> and <code>ArgoCD</code> capability configuration, when the minimal <code>Paas</code> is created with the <code>ArgoCD</code> capability enabled, then the list entry in the applicationset should have been created, and a namespace with the name <code>paasname-argocd</code> should have been created, and an ArgoCD Application should have been created in namespaces, and a quota with the name <code>paasname-argocd</code> should have been created, and the ArgoCD Application and quota conform to the points below.</p> <p>ArgoCD Application points:</p> <ol> <li>Assess gitUrl, path etc. exist in spec;</li> <li>Assess RBAC .. determine how;</li> <li>Assess Secrets exist in namespace and in argo...?</li> <li>Assess Exclude appset is included in spec as ignoreDiff;</li> </ol> <p>Quota points:</p> <ol> <li>Assess a quota with the name <code>paasnaam-argocd</code> was created;</li> <li>Assess that the <code>quota_label</code> label was used as selector on the quota;</li> <li>Assess that the quota selector was set in such a manner so that only the <code>paasnaam-argocd</code> namespace is selected;</li> <li>Assess that the size of the quota equals the size of the default quota specified in the paas_config;</li> </ol> <p>Default_permissions points:</p> <ol> <li>Assess that a rolebinding for <code>monitoring-edit</code> is created</li> <li>Assess that the <code>monitoring-edit</code> rolebinding contains the <code>argo-service-applicationset-controller</code> service account</li> <li>Assess that the <code>monitoring-edit</code> rolebinding contains the <code>argo-service-argocd-application-controller</code> service account</li> </ol> </li> </ol> <p>Post scenarios: reset environment to clean slate.</p>"},{"location":"development-guide/e2e-test-details/#capability-tekton","title":"Capability Tekton","text":"<p>Quota points:</p> <ol> <li>Assess a quota with the name <code>paasnaam-tekton</code> was created;</li> <li>Assess that the <code>quota_label</code> label was used as selector on the quota;</li> <li>Assess that the quota selector was set in such a manner so that only the <code>paasnaam-tekton</code> namespace is selected;</li> <li>Assess that the size of the quota equals the size of the default quota specified in the paas_config;</li> </ol> <p>Default_permissions points:</p> <ol> <li>Assess that a rolebinding for <code>monitoring-edit</code> is created</li> <li>Assess that the <code>monitoring-edit</code> rolebinding contains the <code>tekton</code> service account</li> <li>Assess that a rolebinding for <code>alert-routing-edit</code> is created</li> <li>Assess that the <code>alert-routing-edit</code> rolebinding contains the <code>tekton</code> service account</li> </ol>"},{"location":"development-guide/e2e-test-details/#capability-grafana","title":"Capability Grafana","text":"<p>Check Quota</p>"},{"location":"development-guide/e2e-test-details/#capability-sso","title":"Capability SSO","text":"<p>What we test: creating a <code>Paas</code> with the <code>SSO</code> capability enabled.</p> <p>Scenarios:</p> <ol> <li>A minimal <code>Paas</code> with SSO capability enabled and no capability quota. Given a minimal <code>Paas</code> and <code>SSO</code> capability configuration, when the minimal <code>Paas</code> is created with the <code>SSO</code> capability enabled, then the list entry in the applicationset should have been created, and a namespace with the name <code>paasname-sso</code> should have been created, and a quota with the name <code>paasname-sso</code> should have been created, and the quota conforms to the points below.</li> </ol> <p>Quota points:</p> <ol> <li>Assess that the <code>quota_label</code> label was used as selector on the quota;</li> <li>Assess that the quota selector was set in such a manner so that only the <code>paasnaam-sso</code> namespace is selected;</li> <li> <p>Assess that the size of the quota equals the size of the default quota specified in the paas_config;</p> </li> <li> <p>The <code>Paas</code> from scenario 1 is removed. Given a the <code>Paas</code> remaining from scenario 1 above, when said <code>Paas</code> is deleted, then the associated <code>Quota</code> should have been removed, then the associated <code>Namespace</code> should have been removed, then the associated list entry in the <code>ApplicationSet</code> should have been removed.</p> </li> </ol> <p>Post scenarios: reset environment to clean slate.</p>"},{"location":"development-guide/e2e-test-details/#configurable-capabilities","title":"Configurable capabilities","text":"<p>What we test: adding a new capability with configuration</p> <p>Scenarios:</p> <ol> <li>Add config for a new cap4 and check that it works as expecten when included in a Paas</li> <li>Add cap5 in a Paas and check that it does not work when not yet defined in config</li> </ol>"},{"location":"development-guide/maintaining/","title":"Introduction","text":"<p>This file documents the methods and standards that should be applied by the maintainers of this project. For example: how to create a new release.</p>"},{"location":"development-guide/maintaining/#standards-used","title":"Standards used","text":""},{"location":"development-guide/maintaining/#commits","title":"Commits","text":"<p>We adhere to the Conventional Commits v1.0 standard.</p>"},{"location":"development-guide/maintaining/#versioning","title":"Versioning","text":"<p>For versioning purposes, we adhere to the SemVer v2.0.0 standard with a side note that we always prefix the semantic version number with the character 'v'. This stands for \"version\".</p> <p>As a quick summary, this means we use version numbers in the style of vX.Y.Z. With:</p> <ul> <li>X being major, including breaking, changes;</li> <li>Y being minor, possibly including patch but never breaking, changes;</li> <li>Z being patch, but never breaking, changes;</li> </ul>"},{"location":"development-guide/maintaining/#methods-used","title":"Methods used","text":""},{"location":"development-guide/maintaining/#creating-a-release","title":"Creating a release","text":"<p>We release from <code>main</code>. All changes to <code>main</code> are made through PRs. Merging a PR will trigger the release drafter action to create a draft release.</p> <p>The process to create a release is mostly automated, to start it:</p> <ul> <li>Merge one or more PRs to <code>main</code>;</li> <li>Ensure completeness;</li> <li>Edit the draft release and publish it;</li> </ul>"},{"location":"overview/","title":"Introduction to the Paas Operator","text":"<p>The idea behind the Paas Operator is to create a multi tenancy solution which allows DevOps teams to request a context for their own project, which we like to call a 'Project as a Service', e.a. Paas.</p> <p>This documentation site is arranged into generic, user, administrator and developer sections. If you have any questions or feel that certain parts of the documentation can be improved or expanded, feel free to create a PR (Pull Request).</p> <p>For full contribution guidelines, see the <code>CONTRIBUTING.md</code> file in the root of the repository, the About &gt;&gt; Contributing section and/or the Development Guide.</p>"},{"location":"overview/glossary/","title":"Glossary","text":""},{"location":"overview/glossary/#capabilities","title":"Capabilities","text":"<p>A capability is extra functionality that can be added to your Paas simply by enabling it through your Paas' yaml config.</p> <p>Examples can include, but are not limited to, ArgoCD, Tekton or Grafana.</p>"},{"location":"overview/glossary/#cluster-wide-quotas","title":"Cluster Wide Quotas","text":"<p>With Cluster Wide (resource) Quotas (CWQ), cluster admins can bring all resources for all Paas'es belonging to a capability, together in one cluster wide resource pool.</p> <p>This brings down over commit at the expense of the risk of resource sharing.</p> <p>For more details, see the relevant details in the administrators section</p>"},{"location":"overview/glossary/#crypttool","title":"Crypttool","text":"<p>The crypttool is a small command-line utility that allows a user to perform some simple operations with regards to secrets in a Paas.</p> <p>Basic functionality includes sub-commands for <code>encrypt</code>, <code>decrypt</code> and <code>re-encrypt</code> with regards to Paas related secrets.</p> <p>The <code>re-encrypt</code> sub-command specifically will parse the yaml/json file for a Paas, decrypt the SSH secrets with the previous private key, re-encrypt with the new public key &amp; write back the Paas configuration to the file in either yaml or json format.</p> <p>This will allow for key rotation.</p> <p>You can also run the <code>check-paas</code> sub-command to \"check\" the Paas, which means it will parse the yaml/json file for a Paas, decrypt the SSH secrets and display their length and checksums.</p> <p>Lastly it can be used to <code>generate</code> a new public/private key pair.</p>"},{"location":"overview/glossary/#groups-openshift","title":"Groups [openshift]","text":"<p>Access to a Paas is granted to specific groups, which can be listed in the Paas' configuration file.</p> <p>A group can contain roles that allow them certain permissions, users and/or an LDAP query. When configured, the LDAP query is used to find the members of the group, in addition to any users listed specifically in the Paas configuration.</p> <p>Please be aware that this is an OpenShift specific feature.</p>"},{"location":"overview/glossary/#managedbypaas","title":"ManagedByPaas","text":"<p>This is a field in the Paas configuration, and feature, that allows the user to indicate that this Paas is actually managed by another Paas' ArgoCD.</p>"},{"location":"overview/glossary/#namespace-paasns","title":"Namespace / PaasNs","text":"<p>Namespaces can be used to define extra namespaces to be created as part of this Paas project.</p>"},{"location":"overview/glossary/#quotas","title":"Quotas","text":"<p>There a various quotas that can be configured, but essentially they are: cluster wide, per Paas or for a capability.</p>"},{"location":"overview/glossary/#requestor","title":"Requestor","text":"<p>The requestor is an informational field in the Paas configuration, which can contain a string that is intended to point to the person or group responsible for the application / Paas.</p> <p>This could be an ITIL group, Service desk name, email address or any random string.</p>"},{"location":"overview/glossary/#ssh-secrets","title":"SSH Secrets","text":"<p>You can add SSH keys, which are a type of secret, to your Paas for ArgoCD to use so it can access a git repository. For example on a self-hosted Github or BitBucket instance.</p> <p>The SSH secrets must be encrypted with the public key corresponding to the private key that was deployed together with the Paas operator.</p>"},{"location":"overview/glossary/#web-service","title":"Web service","text":"<p>The web service exposes a <code>/v1/encrypt</code> endpoint that allows a user to encrypt a secret using that cluster's private key.</p> <p>Apart from the encrypt endpoint, some standard endpoints like <code>/healthz</code>, <code>/readyz</code>, <code>/version</code> and <code>/metrics</code> are exposed.</p>"},{"location":"overview/core_concepts/authorization/","title":"Authorization","text":"<p>The whole idea is to create a multi tenancy solution which allows DevOps teams to request a context for their project, which we like to call a 'Project as a Service', e.a. Paas.</p> <p>Requestors of a Paas have the option to setup permissions for groups. Groups can get permissions on namespaces, and additionally get access in the ArgoCD deployed for their Paas. Additionally default groups can get permissions on these ArgoCDs as well.</p> <p>Configuring authorization is done by:</p> <ul> <li>Cluster administrators defining role mappings in the Paas operator configmap;</li> <li>DevOps engineers specifying groups in their Paas resources;</li> <li>DevOps engineers can specify groups in their PaasNs resources;</li> <li>For every PaasNs the PaasNs controller derives the required RoleBindings and   creates as required;</li> <li>If a list is specified in the PaasNs it is correlated to the Paas;     when not defined all groups as specified in the Paas are used by default.</li> <li>For every group, the Paas definition is checked for the functional roles;     when not defined the default role mapping is used.</li> <li>For every functional role the technical roles are derived from the Paas ConfigMap;</li> <li>For every PaasNs namespace the PaasNs controller creates a role binding for     every applicable technical role, and adds the groups that should have the     required permissions;</li> <li>For the <code>argocd</code> capability, the PaasNs controller adds the required permissions   to the RBAC block so that the applicable groups get the permissions in ArgoCD   as required;</li> </ul> <p>Additionally the Paas operator configmap can have additional <code>argopermissions</code> to   be handed to additional groups (e.a. cluster admins).</p>"},{"location":"overview/core_concepts/authorization/#config-examples","title":"Config examples","text":""},{"location":"overview/core_concepts/authorization/#paas-operator-configmap","title":"Paas Operator ConfigMap","text":"<p>The Paas Operator ConfigMap (managed by cluster admins) can be configured as follows:</p> <p>Example</p> <pre><code>apiVersion: cpet.belastingdienst.nl/v1alpha1\nkind: PaasConfig\nmetadata:\n  name: opr-paas-config\nspec:\n  argopermissions:\n    resource_name: argo-service\n    role: admin\n    header: |\n      g, system:cluster-admins, role:admin\n  rolemappings:\n    # All groups defined in a Paas without any roles will have the `default`\n    # functional role which maps to the OpenShift ClusterRole called view\n    default:\n      - view\n    # All groups defined in a Paas with the `edit` functional role will have a\n    # RoleBinding for the ClusterRoles `edit`, `alert-routing-edit`, and\n    # `monitoring-edit`\n    edit:\n      - edit\n      - alert-routing-edit\n      - monitoring-edit\n    # All groups defined in a Paas with the `view` functional role will have a\n    # RoleBinding for the ClusterRoles `view`\n    readonly:\n      - view\n    # All groups defined in a Paas with the `admin` functional role will have\n    # a RoleBinding for the ClusterRoles `admin`, `alert-routing-edit`, and\n    # `monitoring-edit`\n    admin:\n      - admin\n      - alert-routing-edit\n      - monitoring-edit\n  # Required fields with placeholder values\n  capabilities:\n    example-capability:\n      applicationset: example-appset\n      default_permissions: {}\n      extra_permissions: {}\n      quotas:\n        clusterwide: false\n        defaults: {}\n        min: {}\n        max: {}\n        ratio: 0\n  decryptKeyPaths:\n    - /path/to/decrypt/key\n  exclude_appset_name: placeholder-appset-name\n</code></pre> <p>Note</p> <p>Groups that only have view defined will have the same permissions as groups without any functional roles.</p>"},{"location":"overview/core_concepts/authorization/#paas","title":"Paas","text":"<p>Devops engineers could create a Paas with the following definition:</p> <p>Example</p> <pre><code>---\napiVersion: cpet.belastingdienst.nl/v1alpha1\nkind: Paas\nmetadata:\n  name: my-paas\nspec:\n  requestor: my-team\n  groups:\n    # An OpenShift group called `us` is created, and `me` and `you` are added to this group.\n    # `us` group has default permissions\n    us:\n      users:\n        - me\n        - you\n      roles:\n        - admin\n        - edit\n        - view\n    # An OpenShift group called `them` is created, and `friend` is added to this group.\n    them:\n      users:\n        - friend\n      # `them` group has view permissions\n      roles:\n        - view\n  capabilities:\n    # For all capability namespaces (e.a. my-paas-argocd), there will be RoleBindings\n    # for `admin`, `edit`, `alert-routing-edit`, and `monitoring-edit`\n    argocd:\n      enabled: true\n  # For all user namespaces (my-paas-cicd, my-paas-test, and my-paas-prod), there\n  # will be RoleBindings for `admin`, `edit`, `alert-routing-edit`, and `monitoring-edit`\n  namespaces:\n    - cicd\n    - test\n    - prod\n  quota:\n    limits.cpu: \"40\"\n</code></pre> <p>With this example (combined with the operator config example), the following would apply:</p> <ul> <li>In all namespaces (<code>my-paas-cicd</code>, <code>my-paas-test</code>, <code>my-paas-prod</code> and <code>my-paas-argocd</code>),   there will be RoleBindings for <code>admin</code>. They will all contain the groups <code>us</code> group;</li> <li>For all namespaces (<code>my-paas-cicd</code>, <code>my-paas-test</code>, <code>my-paas-prod</code> and <code>my-paas-argocd</code>),   there will be RoleBindings for <code>view</code>. They will all contain the groups <code>us</code>, and <code>them</code>;</li> <li>The <code>argocd-service</code> deployed in <code>my-paas-argocd</code> will have admin permissions set   for all users in group <code>us</code> and group <code>them</code>;</li> </ul> <p>Note</p> <p>That there is also options to manage users with a federated solution. For more information, see ldap integration with groupsynclist.</p>"},{"location":"overview/core_concepts/authorization/#paasns","title":"PaasNs","text":"<p>DevOps engineers could additionally create a PaasNs with the following definition:</p> <p>Example</p> <pre><code>---\napiVersion: cpet.belastingdienst.nl/v1alpha1\nkind: PaasNs\nmetadata:\n  # The name of the resulting namespace would be my-paas-adminonly ([paas name]-[paasns name])\n  name: adminonly\n  namespace: my-paas-argocd\nspec:\n  Paas: my-paas\n  # The namespace would only contain RoleBindings for the `us` group, which drills\n  # down to the `admin`, `edit`, `view`, `alert-routing-edit`, and `monitoring-edit` ClusterRoles.\n  groups:\n    - us\n</code></pre>"},{"location":"overview/core_concepts/authorization/#caveats","title":"Caveats","text":"<ul> <li>All groups will have the permissions as specified in the Paas.</li> <li>The RBAC block of the Paas argocd capability can be externally managed.   That also means that changing the groups, operator config,, etc. does not automatically   apply to existing ArgoCD deployments.</li> <li>Next to permissions on groups and users, there is also capabilities to implement   permissions for service accounts. See extra_permissions for   more info.</li> <li>For ldap integration, the operator has options to manage groups using a groupsynclist   implementation. For more information, see ldap integration with groupsynclist.</li> </ul>"},{"location":"overview/core_concepts/capabilities/","title":"Paas Capabilities","text":"<p>The whole idea of Paas is to create a multi tenancy solution which allows DevOps teams to request a context for their project, which we like to call a 'Project as a Service', e.a. Paas.</p> <p>As part of the Paas we want to allow DevOps teams to consume capabilities 'As A Service'. Examples of such capabilities are:</p> <ul> <li>ArgoCD (Continuous Delivery);</li> <li>Tekton (Continuous Integration);</li> <li>Grafana (Observability); and</li> <li>KeyCloak (Single Sign On);</li> </ul> <p>However, the list could be longer in the future.</p> <p>Every Paas could have one or more of such capabilities enabled, which means they get these capabilities with the required permissions. The DevOps team requires no specific knowledge or permissions to use these capabilities.</p> <p>They are managed by a cluster wide ArgoCD, which creates them according to the standards as defined by the platform team. They would be deployed specifically for their Paas and only usable in that context.</p> <p>We want Product teams to be able to define which capabilities should be available, and to have control over the components that comprise these capabilities.</p> <p>Therefore it is designed a follows:</p> <ul> <li>The available capabilities are all defined in the Paas configuration   Per capability the following can be defined:<ul> <li>the default quota to be used when no quota is set in the Paas</li> <li>if the cluster wide quota feature should be enabled for this capability</li> <li>the ApplicationSet that can be reconfigured (new entry in the list generator)   for each Paas with the capability enabled</li> </ul> </li> <li>For every Paas where the capability is enabled, the Paas controller will create:<ul> <li>a PaasNs</li> <li>an entry in the ApplicationSet List Generator which in creates a new Application,   which in turn makes a cluster wide ArgoCD deployment read from the configured git   repo and create the required resources in the namespace as required</li> </ul> </li> </ul>"},{"location":"overview/core_concepts/capabilities/#example","title":"Example:","text":""},{"location":"overview/core_concepts/capabilities/#paas-config","title":"Paas Config","text":"<p>In the Paas configuration the following could be configured:</p> <p>Example</p> <pre><code>spec:\n  capabilities:\n    # Config for the argocd capability\n    argocd:\n      # For every Paas with this capability enabled, the list generator in the\n      # paas-argocd ApplicationSet should be extended\n      applicationset: paas-argocd\n      # Quotas can be set in the Paas, but for these quotas there are defaults to\n      # apply when not set in the Paas.\n      quotas:\n        clusterwide: false\n        defaults:\n          limits.cpu: \"7\"\n          requests.cpu: \"3\"\n        min: {}\n        max: {}\n        ratio: 0\n      # For all Paas's with the argocd capability enabled, by default also set\n      # these permissions for the specified service account\n      default_permissions:\n        argocd-argocd-application-controller:\n          - monitoring-edit\n          - alert-routing-edit\n      extra_permissions: {}\n    # Config for the grafana capability\n    grafana:\n      # For every Paas with this capability enabled, the list generator in the\n      # paas-grafana ApplicationSet should be extended\n      applicationset: paas-grafana\n      # Quotas can be set in the Paas, but for these quotas there are defaults to\n      # apply when not set in the Paas.\n      quotas:\n        clusterwide: false\n        defaults:\n          limits.cpu: \"2\"\n          requests.cpu: \"1\"\n        min: {}\n        max: {}\n        ratio: 0\n      default_permissions: {}\n      extra_permissions: {}\n</code></pre>"},{"location":"overview/core_concepts/capabilities/#example-applicationset","title":"Example ApplicationSet","text":"<p>The ArgoCD Applicationset could look like this:</p> <p>Example</p> <pre><code>apiversion: argoproj.io/v1alpha1\nkind: applicationset\nmetadata:\n  # name of the applicationset, this can be used for Paas instances with the\n  # argocd capability enabled\n  name: paas-argocd\n  # Specify the namespace of a cluster wide ArgoCD. On OpenShift the openshift-gitops\n  # namespace is meant to have the only cluster wide ArgoCD.\n  namespace: openshift-gitops\nspec:\n  # This list can be empty, but is required in the definition.\n  # Note that the Paas operator will create and manage a list generator here. So\n  # when managing this applicationset with the cluster wide ArgoCD requires setting\n  # up resourceExclusions\n  generators: []\n  template:\n    metadata:\n      name: \"{{paas}}-cpet-capability-argocd\"\n    spec:\n      destination:\n        namespace: \"{{paas}}-argocd\"\n        server: \"https://kubernetes.default.svc\"\n      project: \"{{paas}}\"\n      source:\n        kustomize:\n          commonlabels:\n            capability: argocd\n            clusterquotagroup: \"{{requestor}}\"\n            paas: \"{{paas}}\"\n            service: \"{{service}}\"\n            subservice: \"{{subservice}}\"\n        path: paas-capabilities/argocd\n        repourl: \"ssh://git@github.com/belastingdienst/my-paas-capabilities.git\"\n        targetrevision: master\n      syncpolicy:\n        automated:\n          selfheal: true\n</code></pre>"},{"location":"overview/core_concepts/capabilities/#example-paas","title":"Example Paas","text":"<p>This would mean that someone could create a Paas with a block like this:</p> <p>Example</p> <pre><code>apiVersion: cpet.belastingdienst.nl/v1alpha1\nkind: Paas\nmetadata:\n  name: my-paas\nspec:\n  capabilities:\n    argocd:\n      enabled: true\n      # Bootstrap application to point to the root folder\n      gitPath: .\n      # Bootstrap application to point to the main branch\n      gitRevision: main\n      # Bootstrap application to point to this repo\n      gitUrl: \"ssh://git@github.com/belastingdienst/my-paas-repo.git\"\n    grafana:\n      enabled: true\n      quota:\n        limits.cpu: \"5\"\n        limits.memory: \"2Gi\"\n</code></pre> <p>This would result in:</p> <ul> <li>a <code>my-paas-argocd</code> <code>ClusterResourceQuota</code> and a <code>my-paas-grafana</code> <code>ClusterResourceQuota</code>;</li> <li><code>my-paas-argocd</code> has default quotas as specified in the configuration;      (<code>limits.cpu: \"7\"</code>, <code>requests.cpu: \"3\"</code>)</li> <li><code>my-paas-grafana</code> has <code>limits.cpu</code> overridden to \"5\", <code>requests.cpu</code> defaulting to \"1\" and <code>limits.memory</code> set to '2Gi';</li> <li>a <code>my-paas</code> namespace with a <code>argocd</code> PaasNs and a <code>grafana</code> PaasNs;</li> <li>a namespace called <code>my-paas-argocd</code> linked to the <code>my-paas-argocd</code> <code>ClusterResourceQuota</code>;   The <code>applicationset</code> has an extra entry for the namespace so that the cluster-wide   ArgoCD will create a namespaced ArgoCD deployment in this namespace. The Paas operator   creates a bootstrap application which points to the root folder (<code>.</code>) of main   branch of the <code>ssh://git@github.com/belastingdienst/my-paas-repo.git</code> repository.</li> <li>a namespace called <code>my-paas-grafana</code> linked to the <code>my-paas-grafana</code> <code>ClusterResourceQuota</code>;   The <code>applicationset</code> has an extra entry for the namespace so that the cluster-wide   ArgoCD will create a grafana deployment in this namespace.</li> </ul>"},{"location":"overview/core_concepts/groupsynclist/","title":"Caas-groupsynclist","text":"<p>The current implementation we have running on Openshift internally relies on running <code>oc adm groups sync</code> commands periodically.</p> <p>The information for this job comes from a ConfigMap called <code>groupsynclist</code>.</p> <p>We are in the process of changing this solution to a more K8S generic solution for management of Users and Groups.</p> <p>If you are working on ldap integration in a more K8S generic way, feel free to issue a PR.</p>"},{"location":"overview/core_concepts/integrations/","title":"OpenShift","text":"<p>The whole idea we tried to solve with the Paas operator, is to create a multi tenancy solution which allows DevOps teams to request a context for their project, which we like to call a 'Project as a Service', e.a. Paas.</p> <p>This aligns heavily with large clusters servicing multiple DevOps teams, which aligns closely with how we see other organizations running OpenShift.</p> <p>For other deployments we mostly see small (nearly vanilla) K8S deployments, where each cluster is only servicing one Devops team specifically. However, we do also feel that having a single interface to consume features like user management, capabilities, and quota management could be helpful to have in non-OpenShift environments too.</p>"},{"location":"overview/core_concepts/integrations/#openshift-specific-dependencies","title":"OpenShift specific dependencies","text":"<p>We rely on OpenShift for the following features:</p> <ul> <li>Cluster Wide Quotas, which seems to be built into the core of OpenShift and does   not seem to have a k8s generic alternative. Running on vanilla K8S, we would   probably leave options to have one quota for multiple namespaces and implement   normal ResourceQuota definitions instead.</li> <li>We currently rely on the Groups implementation in OpenShift. We are revisiting   the current architecture and will work towards a solution that can work natively   in K8S as good as possible.</li> </ul>"},{"location":"overview/core_concepts/integrations/#argocd-integrations","title":"ArgoCD integrations","text":""},{"location":"overview/core_concepts/integrations/#argocd-operator","title":"ArgoCD operator","text":"<p>The Paas operator has the option to create capabilities and for the argocd capability we integrate with the argocd operator.</p> <p>This means that for the argocd capability, the Paas operator creates the ClusterResourceQuota, Namespace, Permissions, etc. and creates an ArgoCD resource and a bootstrap Application (App of the Apps).</p> <p>The argocd-operator can be used on any K8S. On OpenShift it is known as the OpenShift GitOps operator and is available through OLM.</p>"},{"location":"overview/core_concepts/integrations/#argocd-applicationset-list-generators","title":"ArgoCD ApplicationSet List Generators.","text":"<p>The Paas operator has the option to create capabilities and to keep the implementations of capabilities freely programmable we have integrated the Paas operator with ArgoCD.</p> <p>This means that the expectations of running the Paas operator with capabilities, is that there is a cluster wide ArgoCD deployment available, and for each capability there is an additional ApplicationSet to manage Paas capabilities.</p> <p>The Paas operator integrates through these capabilities by managing a list generator in the ApplicationSet, which in turn creates an ArgoApplication for every enabled capability in every enabled Paas.</p>"},{"location":"overview/core_concepts/integrations/#argocd-bootstrap","title":"ArgoCD bootstrap","text":"<p>When the ArgoCD capability is enabled, values from the Paas (git_url, git_revision, git_path) are copied to an application in the argocd capability namespace for the Paas (next to ArgoCD). Once ArgoCD has been initialized and started, this app-of-the-apps Application will make ArgoCD create all resources which are found in this location (git_url, git_revision, git_path). The main idea is for the requestor to define all other Applications and ApplicationSets, and link them to the specific end resources that together make up all resources for the CI, Application, etc.</p> <p>The entire boostrapping of a Paas is performed through the following steps: </p> <ol> <li>The Paas is applied on the Kubernetes cluster.</li> <li> <p>The paas operator:</p> </li> <li> <p>creates all namespaces as defined in <code>spec.namespaces</code> and a namespace for every enabled capability in <code>spec.capabilities</code>.</p> </li> <li> <p>adds an entry in the list generator for this Paas for every capability (argocd being one of them), which creates an Application for every enabled capability for this Paas.      The Application created for the argocd capability for this Paas makes the cluster-wide argocd create an ArgoCD in the namespace belonging to this capability for this Paas.</p> </li> <li> <p>The paas operator creates the bootstrap Application in the namespace for the ArgoCD deployed in the argocd namespace for this Paas.</p> </li> <li>The bootstrap application makes the ArgoCD running in the argocd namespace for this paas check the github repo and create all (Application and ApplicationSet) resources as defined there.</li> <li>One Application (as defined by the requestor in his git repo) has all resources in the tekton namespace created.    This could be pipelines, trigger templates, etc. Everything as required to define and run CI.</li> <li>An ApplicationSet might have a github generator which is triggered by github Pull Requests.    The generater creates an Application for every PR    The Application creates all resources as defined in a namespace belonging to the paas.    Tekton could then be utilized to run e2e tests against the deployed version of the application and return feedback to the Pull Request.</li> </ol>"},{"location":"overview/core_concepts/paas/","title":"Paas","text":"<p>The whole idea is to create a multi tenancy solution which allows DevOps teams to request a context for their project, which we like to call a 'Project as a Service', e.a. Paas.</p> <p>The Paas is a higher level construct, which consists of many parts, including:</p> <ul> <li>namespaces;</li> <li>Quotas;</li> <li>authorization;</li> <li>capabilities;</li> </ul> <p>DevOps teams request this Paas context by defining a Paas resource through the K8S API.</p> <p>At the very least a Paas resource has the following defined:</p> <ul> <li><code>apiVersion</code>, kind (as needs to be defined for every other k8s resource)</li> <li><code>metadata.name</code>, which is unique (cluster-wide)</li> <li><code>spec.requestor</code>, which is an informational field representing the requestor of   this Paas, for administrative purposes</li> <li><code>quota</code>, which sets the amount of quota for all namespaces that are part of   this Paas (capability namespaces excluded)</li> </ul> <p>Additionally the following optional settings can also be defined:</p> <ul> <li><code>capabilities</code>, which can be used to enable Paas extensions such as an ArgoCD to   manage all Paas namespaces, Grafana to monitor Paas namespaces, etc. More information   can be found in our capabilities documentation.</li> <li><code>spec.sshSecrets</code>, which can be used to seed secrets that ArgoCD requires for   accessing repositories. See sshSecrets for more information.</li> <li><code>spec.groups</code>, which can be used to configure authorization. See authorization   for more information.</li> <li><code>spec.namespaces</code>, which can be used to define namespaces as part of the Paas.   Alternatively, they can be manually defined as PaasNs resources.</li> </ul>"},{"location":"overview/core_concepts/paas/#example-paas","title":"Example Paas","text":"<p>Example</p> <pre><code>apiVersion: cpet.belastingdienst.nl/v1alpha1\nkind: Paas\nmetadata:\n  name: my-paas\nspec:\n  capabilities:\n    # Enable argocd\n    argocd:\n      enabled: true\n      # Bootstrap application to point to the root folder\n      gitPath: .\n      # Bootstrap application to point to the main branch\n      gitRevision: main\n      # Bootstrap application to point to this repo\n      gitUrl: \"ssh://git@github.com/belastingdienst/my-paas-repo.git\"\n    # enable grafana\n    grafana:\n      enabled: true\n      quota:\n        limits.cpu: \"5\"\n        limits.memory: \"2Gi\"\n</code></pre> <p>Notes</p> <p>Labels defined on Paas resources are copied to child resources such as PaasNs, quotas, groups, ArgoApps, ArgoProjects, etc.</p> <p>The only exception is the <code>app.kubernetes.io/instance</code>.</p>"},{"location":"overview/core_concepts/paasns/","title":"PaasNs","text":"<p>We wanted to enable our DevOps teams without them requiring self-provisioner permissions. The main reason is that self-provisioner is too broadly usable and abusable, and as such we could not enforce the guardrails we felt that a true multi-tenancy solution should protect.</p> <p>However, we also wanted to bring them as much self-service as we could think of and dynamically creating and destroying namespaces felt like part of the flexibility that would be required.</p> <p>For this exact reason, we have introduced the concept of PaasNs.</p> <p>The concept works as follows:</p> <p> For every Paas, the operator also creates a system namespace called exactly the same as the Paas. This system is not visible to DevOps teams and is only meant to be used by the Paas operator to keep the PaasNs objects for all capabilities and namespaces which are directly defined in the Paas, meaning:</p> <ul> <li>all namespaces in the <code>spec.namespaces</code> block of a Paas resource;</li> <li>all namespaces required by Paas capabilities;</li> </ul> <p>Besides PaasNs resources created directly by the Paas controller, Devops teams can also create their own PaasNs resources as long as they are created in a namespace belonging to the Paas.</p> <p>As an example, assuming a Paas called <code>my-paas</code> with:</p> <p>Example</p> <pre><code>---\napiVersion: cpet.belastingdienst.nl/v1alpha1\nkind: Paas\nmetadata:\n  name: my-paas\nspec:\n  capabilities:\n    # The argocd capability enabled\n    argocd:\n      enabled: true\n  requestor: my-team\n  quota:\n    limits.cpu: \"40\"\n</code></pre> <p>To add user namespaces, the following options are available:</p> <ul> <li>In this Paas, the <code>spec.namespaces</code> field could have a list of namespaces.   If this would be set to (just as an example) <code>[ ns1, ns2, ns3 ]</code>, the Paas   controller would create three PaasNs resources in a namespace called <code>my-paas</code>.</li> </ul> <p>The PaasNs controller would process them as being part of <code>my-paas</code> and create   the following namespaces: <code>my-paas-ns1</code>, <code>my-paas-ns2</code> and <code>my-paas-ns3</code>.</p> <ul> <li>Another option would be to manually create a PaasNs resource in a namespace   which already belongs to <code>my-paas</code>.</li> </ul> <p>Example</p> <pre><code>---\napiVersion: cpet.belastingdienst.nl/v1alpha1\nkind: PaasNs\nmetadata:\n  name: my-ns\n  namespace: my-paas-argocd\nspec:\n  Paas: my-paas\n</code></pre> <ul> <li> <p>Yet another option would be to create a PaasNs resource using automation such as   <code>argocd</code> or <code>tekton</code>.   It is advised to create them in the namespace belonging to the capability that   is being used (e.a. <code>my-paas-argocd</code> or <code>my-paas-tekton</code>).</p> </li> <li> <p>A cool feature is that PaasNs resources could be stacked. This means that a   PaasNs resource could be in a namespace which is the product of a PaasNs   resources in a namespace, which...</p> </li> </ul> <p>As as the top namespace is the product of a PaasNs resource in the namespace   called after the Paas, all child PaasNs's are assumed to be part of the same Paas.</p> <p>Note</p> <p>Note that besides creating the namespaces, the PaasNs controller also properly sets up the namespace with the proper quota and the proper authorization.</p>"},{"location":"overview/core_concepts/sshsecrets/","title":"sshSecrets","text":"<p>SshSecrets is implemented to enable bootstrapping a project 100% 'as code'.</p> <p>The idea is that people can create a Paas to bootstrap an application front to back, including required namespaces, quotas, a application specific ArgoCD and a running application, in one go.</p> <p>However, when using private repositories, ArgoCD needs to be provided with an SSH key (as a secret) for ArgoCD to gain access to the git repository. These ssh secrets need to be provided before ArgoCD can start acting on repo contents, which is why providing these secrets is part of the Paas solution.</p> <p>Another consideration was that we want <code>sshSecrets</code> to be defined in a Paas, and since Paas can be readable to the world, and we naturally don't want the secrets to be open, which is why we implemented encryption.</p> <p>Encryption is based on RSA where a public key (shared with everyone) is used to encrypt, and a private key (deployed with the Paas operator) is used to decrypt. Which that everyone can encrypt, but only the Paas operator can decrypt.</p> <p>Note</p> <p>Note that we implemented <code>sshSecrets</code> for this use case, but they are implemented generically, and can also be used to seed secrets into other namespaces (capability and user namespaces)...</p> <p>For ease of use, and to enable extra management capabilities, the Paas operator comes with additional tooling:</p> <ul> <li>an API, which can be used to encrypt without needing to share the public key;</li> <li>a crypt tool which can be leveraged to encrypt, re-encrypt, generate key pairs,   and inspect encrypted keys;</li> </ul> <p>Both of these tools require access to the private key to be usable...</p>"},{"location":"overview/core_concepts/sshsecrets/#how-it-works","title":"How it works","text":"<ul> <li>A DevOps engineer generates a SSH key pair;</li> <li>The DevOps engineer configures his public SSH key to be accepted by his git   repository (e.a. github, gitlab, gitea, bitbucket, etc.)</li> <li>The DevOps engineer encrypts the private SSH key with the api, or with the CLI;   Encryption is done using the Paas public key (the result can only be decrypted   using the Paas private key).   The result is called a <code>sshSecret</code>.</li> <li>The DevOps engineer creates (or modifies) a Paas with the <code>sshSecret</code>;</li> <li>Paas controller creates a PaasNs with the <code>sshSecret</code> included;</li> <li>PaasNs controller creates the required namespaces, ArgoCD resource and ArgoCD   repo definition (which is a K8S secret);</li> <li>ArgoCD contacts git and uses the secret to authenticate;</li> <li>ArgoCD creates resources as is defined in the git repository;</li> <li>Application comes alive;</li> </ul> <pre><code>blockdiag {\n  \"SSH private key\" -&gt; encryption -&gt; sshSecret -&gt; Paas -&gt; operator -&gt; \"ArgoCD namespace\";\n  \"Paas public key\" -&gt; encryption;\n  \"Paas private key\" -&gt; operator;\n  operator -&gt; \"ArgoCD quota\";\n  operator -&gt; \"ArgoCD\";\n  operator -&gt; \"ArgoCD repo (secret)\";\n  operator -&gt; \"Other capabilities\";\n  operator -&gt; \"Other namespaces\";\n  operator -&gt; \"...\";\n  \"SSH private key\" [color = \"greenyellow\"];\n  \"Paas public key\" [color = \"pink\"];\n  \"Paas private key\" [color = \"pink\"];\n  \"ArgoCD repo (secret)\" [color = orange];\n}\n</code></pre>"},{"location":"overview/core_concepts/sshsecrets/#defining-an-sshsecret","title":"Defining an <code>sshSecret</code>","text":"<p><code>sshSecret</code>s are processed by the PaasNs controller and as such need to be defined in the PaasNs. Additionally, <code>sshSecret</code>s can also be created in a Paas.</p>"},{"location":"overview/core_concepts/sshsecrets/#defining-sshsecrets-in-a-paas","title":"Defining <code>sshSecret</code>s in a Paas","text":"<p>The Paas controller only manages PaasNs's created by the controller as defined by the Paas.</p> <p>Note</p> <p>PaasNs resources which are not created by the Paas controller require <code>sshSecrets</code> to be configured as part of the PaasNs definition.</p> <p><code>sshSecret</code>s can be defined in a Paas on 2 levels:</p> <ul> <li>as part of the spec, in which case the Paas controller will add the <code>sshSecret</code>   to every PaasNs created by the Paas controller</li> <li>as part of capability, in which case the Paas controller will add the <code>sshSecret</code>   to PaasNs created for this capability specifically</li> </ul> <p>This is the normal use case (part of the argocd capability)</p> <p>Example</p> <pre><code>---\napiVersion: cpet.belastingdienst.nl/v1alpha1\nkind: Paas\nmetadata:\n  name: my-paas\nspec:\n  # Specifying a sshSecret for all capability- and functional- namespaces\n  sshSecrets:\n    \"ssh://git@github.com/belastingdienst/paas.git\": &gt;-\n      2wkeKebCnqgl...L/jDAUmhWG3ng==\n  capabilities:\n    argocd:\n      # Specifying a sshSecret for a specific capability namespace\n      sshSecrets:\n        \"ssh://git@github.com/belastingdienst/paas.git\": &gt;-\n          2wkeKebCnqgl...L/jDAUmhWG3ng==\n  requestor: my-team\n  quota:\n    limits.cpu: \"40\"\n</code></pre>"},{"location":"overview/core_concepts/sshsecrets/#defining-sshsecrets-in-a-paasns","title":"Defining <code>sshSecret</code>s in a PaasNs","text":"<p>The PaasNs controller is the one to manage the secrets in the Paas namespaces a defined in the PaasNs (either manually created or managed by the Paas controller).</p> <p>The PaasNs controller will update SSH secrets in the namespace if the <code>sshSecret</code> value is changed in the PaasNs resource. However, when the key changes (e.a. <code>ssh://git@github.com/belastingdienst/paas.git</code> in the example below), the original SSH secret is not removed.</p> <p>Example</p> <pre><code>---\napiVersion: cpet.belastingdienst.nl/v1alpha1\nkind: PaasNs\nmetadata:\n  name: my-ns\n  namespace: my-paas-argocd\nspec:\n  paas: my-paas\n  sshSecrets:\n    \"ssh://git@github.com/belastingdienst/paas.git\": &gt;-\n      2wkeKebCnqgl...L/jDAUmhWG3ng==\n</code></pre>"},{"location":"user-guide/01_basic-usage/","title":"Basic Usage","text":""},{"location":"user-guide/01_basic-usage/#minimal-paas-managed-by-another-paas","title":"Minimal Paas managed by another Paas","text":"<p>Creating a configuration file to define a Paas is fairly straight forward. The configuration file should use the current API version <code>cpet.belastingdienst.nl/v1alpha1</code> and define a <code>kind: Paas</code>.</p> <p>The most minimal configuration requires at least a <code>name</code> in the <code>metadata</code> section and either a capability <code>argocd</code> that is <code>enabled</code>, or a <code>managedByPaas</code> entry.</p> <p>In the following example, we'll use the latter. The <code>managedByPaas</code> entry should contain the name of the Paas that is allowed to manage this Paas.</p> <p>Example Paas definition being managed by another Paas:</p> <p>Example</p> <pre><code>---\napiVersion: cpet.belastingdienst.nl/v1alpha1\nkind: Paas\nmetadata:\n  name: tst-tst\nspec:\n  managedByPaas: trd-prt\n</code></pre>"},{"location":"user-guide/01_basic-usage/#minimal-paas-self-managed-using-argocd","title":"Minimal Paas, self-managed using ArgoCD","text":"<p>Example Paas definition, using its own ArgoCD:</p> <p>Example</p> <pre><code>---\napiVersion: cpet.belastingdienst.nl/v1alpha1\nkind: Paas\nmetadata:\n  name: tst-tst\nspec:\n  capabilities:\n    argocd:\n      enabled: true\n      gitPath: environments/production\n      gitRevision: main\n      gitUrl: &gt;-\n        ssh://git@git.example.nl/example/example-repo.git\n</code></pre>"},{"location":"user-guide/02_adding-extras/","title":"Adding extra components","text":""},{"location":"user-guide/02_adding-extras/#ssh-secrets","title":"SSH Secrets","text":"<p>It is possible to define SSH secrets for your Paas's ArgoCD to use for access to Github or BitBucket. They must be encrypted with the public key corresponding to the private key that was deployed with the Paas operator.</p> <p>SSH Secrets can be either defined on the generic <code>spec</code> level or underneath the <code>argocd</code> capability.</p> <p>Example</p> <pre><code>apiVersion: cpet.belastingdienst.nl/v1alpha1\nkind: Paas\nmetadata:\n  name: tst-tst\nspec:\n  sshSecrets:\n    'ssh://git@my-git-host/my-git-repo.git': &gt;-\n      2wkeKe...g==\n</code></pre>"},{"location":"user-guide/02_adding-extras/#groups-and-users","title":"Groups and Users","text":"<p>It is possible to define groups in your Paas to allow access to the Paas' resources. These groups are filled with either an LDAP query and/or a list of users.</p> <p>When both an LDAP query and a list of users is defined, the users from the list are added in addition to the users from the LDAP group. If the user from the list was already added through the LDAP group, the user is simply ignored.</p> <p>Example</p> <pre><code>apiVersion: cpet.belastingdienst.nl/v1alpha1\nkind: Paas\nmetadata:\n  name: tst-tst\nspec:\n  groups:\n    example_group:\n      query: &gt;-\n        CN=example_group,OU=example,OU=UID,DC=example,DC=nl\n      users:\n        - jdsmith\n    second_example_group:\n      users:\n        - jdsmith\n</code></pre>"},{"location":"user-guide/02_adding-extras/#paas-quota","title":"Paas Quota","text":"<p>It is possible to request a specific quota for your Paas. This request will be ignored if cluster wide resource quotas are configured by the administrators.</p> <p>Note</p> <p>Please note these will never overrule the maximum values configured by the administrators.</p> <p>Example</p> <pre><code>apiVersion: cpet.belastingdienst.nl/v1alpha1\nkind: Paas\nmetadata:\n  name: tst-tst\nspec:\n  quota:\n    limits.cpu: '40'\n    limits.memory: 64Gi\n    requests.cpu: '20'\n    requests.memory: 32Gi\n    requests.storage: 200Gi\n</code></pre>"},{"location":"user-guide/02_adding-extras/#capabilities","title":"Capabilities","text":"<p>It is possible to easily add certain capabilities to your Paas through the yaml configuration. For each capability you are also able to request a certain quota.</p> <p>Example</p> <pre><code>apiVersion: cpet.belastingdienst.nl/v1alpha1\nkind: Paas\nmetadata:\n  name: tst-tst\nspec:\n  capabilities:\n    argocd:\n      enabled: true\n      gitPath: environments/production\n      gitRevision: main\n      gitUrl: &gt;-\n        ssh://git@git.example.nl/example/example-repo.git\n    grafana:\n      enabled: true\n    sso:\n      enabled: true\n      quota:\n        limits.cpu: '5'\n        limits.memory: 8Gi\n        requests.cpu: '2'\n        requests.memory: 2Gi\n        requests.storage: 100Gi\n    tekton:\n      enabled: true\n      quota:\n        limits.cpu: '32'\n        limits.memory: 32Gi\n        requests.cpu: '16'\n        requests.memory: 16Gi\n        requests.storage: 40Gi\n</code></pre>"},{"location":"user-guide/02_adding-extras/#adding-extra-application-namespaces","title":"Adding extra application namespaces","text":"<p>It is possible to define a list of extra namespaces to be created within the Paas. These can be used for various purposes like dev, test and prod or for example a team member's personal test.</p> <p>These namespaces count towards the global quota requested by the Paas.</p> <p>Example</p> <pre><code>apiVersion: cpet.belastingdienst.nl/v1alpha1\nkind: Paas\nmetadata:\n  name: tst-tst\nspec:\n  namespaces:\n    - mark\n    - tst\n    - acceptance\n    - prod\n    - joel\n</code></pre>"}]}